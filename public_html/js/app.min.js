var app = app || {};

(function(body){
    "use strict";

    app = {
        
        init: function() {
            this.dropdown.init();
            // this.map.init();
            // this.faq.init();
            // this.faq.morph();
            // this.fixmenu.init();
            // this.ajaxForm.init();
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    var $body = $('body'),
        _this;

    app.ajaxForm = {

        config: {
            form_class: '.form-ajax',
            form_reset: 'form-reset',
            link_class: '.js-request-link',
            error_class: 'error',
            error_message: 'form__error-message',
            error_message_class: 'j-error-message',
            error_message_addclass: 'show',
            form_label: '.form__wrapper',
            checkbox_label: 'checkbox__label'
        },

        callback_stack: {},

        extend: function(config)
        {
            _this = this;

            if (typeof config !== 'undefined')
            {
                var x;
                for (x in config)
                {
                    if (typeof _this.config[x] !== 'undefined')
                        _this.config[x] = config[x];
                }
            }
        },

        default_handler: function(form, response)
        {
            _this = this;

            if (response.status)
            {
                if (response.hasOwnProperty('redirect_url'))
                {
                    window.location.href = response.redirect_url;
                }
            }
            else if (typeof response.errors !== 'undefined' || typeof response.error_message !== 'undefined')
            {
                var errors, error_message;

                if (typeof response.errors !== 'undefined')
                {
                    errors = response.errors;
                }

                if (typeof response.error_message !== 'undefined')
                {
                    error_message = response.error_message;
                }

                _this.validation(form, errors, response.error_message);
            }

            if (response.hasOwnProperty('open_popup'))
            {
                if ($('body').find('.popup.is-open').length)
                {
                    $.popup.close($('body').find('.popup.is-open'), function(){
                        $.popup.open(response.open_popup);
                    });
                }
                else
                {
                    $.popup.open(response.open_popup);
                }
            }

            if (response.hasOwnProperty('message'))
            {
                $.popup.message(response.title, response.message);
            }

        },

        validation: function(form, errors, error_message)
        {
            _this = this;

            form.find('.' + _this.config.error_class).removeClass(_this.config.error_class);
            form.find('.' + _this.config.error_message).remove();
            form.find('.' + _this.config.error_message_class).removeClass(_this.config.error_message_addclass);

            var fieldName, field;

            setTimeout(function() {
                if (typeof error_message !== 'undefined' && error_message !== '')
                {
                    form.find('.' + _this.config.error_message_class).html(error_message);
                    form.find('.' + _this.config.error_message_class).addClass(_this.config.error_message_addclass);
                }

                if (typeof errors !== 'undefined' && errors !== '')
                {
                    for(fieldName in errors)
                    {
                        if (form.find('input[name="'+fieldName+'"]').length > 0)
                        {
                            field = form.find('input[name="'+fieldName+'"]');
                        }

                        if (form.find('select[name="'+fieldName+'"]').length > 0)
                        {
                            field = form.find('select[name="'+fieldName+'"]');
                        }

                        if (form.find('textarea[name="'+fieldName+'"]').length > 0)
                        {
                            field = form.find('textarea[name="'+fieldName+'"]');
                        }

                        if (field.closest('.' + _this.config.checkbox_label).length > 0)
                        {
                            field = field.closest('.' + _this.config.checkbox_label);
                        }

                        if (typeof field !== 'undefined')
                        {
                            field.addClass(_this.config.error_class);
                            field.closest(_this.config.form_label).append('<div class="' + _this.config.error_message + '">' + errors[fieldName] + '</div>');
                        }
                    }
                }
            }, 10);
        },

        upload: function()
        {
            _this = this;

            $body.on('submit', '.form-file-upload', function(e) {
                return AIM.submit(this, {
                    onStart: function()
                    {

                    },
                    onComplete: function(result)
                    {
                        if (typeof result === 'object' && result.status === true && result.hasOwnProperty('photo_url'))
                        {

                        }
                    }
                });
            });

            $(document).on('change', '.upload_button_onchange', function(){
                if ($(this).closest('.upload_button').find('.upload_button_field').length > 0)
                {
                    $(this).closest('.upload_button').find('.upload_button_field').html($(this).val());
                }
            });
        },

        send: function(action, method, data, cb, err)
        {

            if (typeof cb !== 'function') {
                cb = function() {};
            }

            if (typeof err !== 'function') {
                err = function() {};
            }

            try {

                $.ajaxSetup({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    }
                });

                $.ajax({
                    url: action,
                    type: method,
                    data: data,
                    contentType: false,
                    processData: method.toLowerCase() == 'get',
                    success: cb,
                    error: err,
                    dataType: 'JSON'
                });

            } catch(e){}

        },

        initLink: function()
        {
            _this = this;

            $body.on('click', _this.config.link_class, function(e) {
                e.preventDefault ? e.preventDefault() : e.returnValue = false;

                var link = $(this);

                if (link.data('is-busy')) {
                    return;
                }

                link.data('is-busy', true);

                var action = ($(this).attr('href')) || $(this).data('action'),
                    method = ($(this).data('method')) || 'get',
                    data = {};

                _this.send(
                    action,
                    method,
                    data,
                    function(response)
                    {
                        if (link.data('callback') && _this.callback_stack.hasOwnProperty(link.data('callback')))
                        {
                            _this.callback_stack[link.data('callback')](link, response);
                        }
                        else
                        {
                            _this.default_handler(link, response);
                        }

                        if (response.status === true)
                        {

                        }

                        link.data('is-busy', false);
                    },
                    function(response)
                    {
                        _this.default_handler(link, response);
                        link.data('is-busy', false);
                    }
                );
            });
        },

        initForm: function()
        {
            _this = this;

            $body.on('submit', _this.config.form_class, function(e) {
                e.preventDefault ? e.preventDefault() : e.returnValue = false;

                var form    = $(this),
                    action  = form.attr('action'),
                    method  = (form.attr('method') || 'post'),
                    data    = !!window.FormData ? new FormData(form[0]) : form.serialize();

                if (form.data('is-busy')) {
                    return;
                }

                form.data('is-busy', true);

                if (typeof button !== 'undefined')
                {
                    if (button.data('loading'))
                    {
                        button.data('original', button.text());
                        button.text(button.data('loading'));
                    }

                    button.addClass('preload');
                }

                if (form.data('precallback') && _this.callback_stack.hasOwnProperty(form.data('precallback'))) {
                    if(!_this.callback_stack[form.data('precallback')](form))
                    {
                        return false;
                    }
                }

                _this.send(
                    action,
                    method,
                    data,
                    function(response)
                    {
                        if (form.data('callback') && _this.callback_stack.hasOwnProperty(form.data('callback')))
                        {
                            _this.callback_stack[form.data('callback')](form, response);
                        }
                        else
                        {
                            _this.default_handler(form, response);
                        }

                        if (response.status === true)
                        {
                            if (form.hasClass(_this.config.form_reset))
                            {
                                form.find('.' + _this.config.error_class).removeClass(_this.config.error_class);
                                form.get(0).reset();
                            }
                        }

                        if (typeof button !== 'undefined')
                        {
                            if (button.data('original'))
                            {
                                button.text(button.data('original'));
                            }

                            button.removeClass('preload');
                        }

                        form.data('is-busy', false);
                    },
                    function(response)
                    {
                        _this.default_handler(form, response);
                        form.data('is-busy', false);
                    }
                );
            });
        },

        init: function(config)
        {
            this.extend(config);

            this.initForm();
            this.initLink();
        }
    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

	var _this;

	app.ajaxForm = {

        config: {
            form_class: '.form-ajax',
            form_reset: 'form-reset',
            link_class: '.js-request-link',
            error_class: 'error',
            error_message: 'form__error-message',
            error_message_class: 'j-error-message',
            error_message_addclass: 'show',
            form_label: '.form__wrapper',
            checkbox_label: 'checkbox__label'
        },

		callback_stack: {},

		extend: function(config)
		{
			_this = this;

			if (typeof config !== 'undefined')
			{
				var x;
				for (x in config)
				{
					if (typeof _this.config[x] !== 'undefined')
						_this.config[x] = config[x];
				}
			}
		},

		default_handler: function(form, response)
		{
			_this = this;

            if (response.status)
            {
                if (response.hasOwnProperty('redirect_url'))
                {
                    window.location.href = response.redirect_url;
                }
            }
            else if (typeof response.errors !== 'undefined' || typeof response.error_message !== 'undefined')
            {
                var errors, error_message;

                if (typeof response.errors !== 'undefined')
                {
                    errors = response.errors;
                }

                if (typeof response.error_message !== 'undefined')
                {
                    error_message = response.error_message;
                }

                _this.validation(form, errors, error_message);
            }
			
            if (response.hasOwnProperty('run_script'))
            {
                if (typeof(window[response.run_script]) == 'function')
                {
                    window[response.run_script]();
                }
            }

            if (response.hasOwnProperty('open_popup'))
            {
            	if ($('body').find('.popup.is-open').length)
            	{
            		$.popup.close($('body').find('.popup.is-open'), function(){
            			$.popup.open(response.open_popup);
            		});
            	}
            	else
            	{
            		$.popup.open(response.open_popup);
            	}
            }

			if (response.hasOwnProperty('message'))
			{
				$.popup.message(response.title, response.message);
			}

		},

		validation: function(form, errors, error_message)
        {
            _this = this;

            form.find('.' + _this.config.error_class).removeClass(_this.config.error_class);
            form.find('.' + _this.config.error_message_class).removeClass(_this.config.error_message_addclass);
            
            var fieldName, field;

            setTimeout(function() {
                if (typeof error_message !== 'undefined' && error_message !== '')
                {
                    form.find('.' + _this.config.error_message_class).html(error_message);
                    form.find('.' + _this.config.error_message_class).addClass(_this.config.error_message_addclass);
                }

                if (typeof errors !== 'undefined' && errors !== '')
                {
                    for(fieldName in errors)
                    {
                        if (form.find('input[name="'+fieldName+'"]').length > 0)
                        {
                            field = form.find('input[name="'+fieldName+'"]');
                        }

                        if (form.find('select[name="'+fieldName+'"]').length > 0)
                        {
                            field = form.find('select[name="'+fieldName+'"]');
                        }

                        if (form.find('textarea[name="'+fieldName+'"]').length > 0)
                        {
                            field = form.find('textarea[name="'+fieldName+'"]');
                        }

                        if (field.closest('.' + _this.config.checkbox_label).length > 0)
                        {
                            field = field.closest('.' + _this.config.checkbox_label);
                        }

                        if (typeof field !== 'undefined')
                        {
                            field.addClass(_this.config.error_class);
                            field.closest(_this.config.form_label).append('<div class="' + _this.config.error_message + '">' + errors[fieldName] + '</div>');
                        }
                    }
                }
            }, 10);
        },

		upload: function()
		{
			_this = this;

			$('body').on('submit', '.form-file-upload', function(e) {
				return AIM.submit(this, {
					onStart: function()
					{

					},
					onComplete: function(result)
					{
						if (typeof result === 'object' && result.status === true && result.hasOwnProperty('photo_url'))
						{

						}
					}
				});
			});
			
			$(document).on('change', '.upload_button_onchange', function(){
				if ($(this).closest('.upload_button').find('.upload_button_field').length > 0)
				{
					$(this).closest('.upload_button').find('.upload_button_field').html($(this).val());
				}
			});
		},

		send: function(action, method, data, cb, err)
		{

			if (typeof cb !== 'function')
			{
				cb = function() {};
			}

			if (typeof err !== 'function')
			{
				err = function() {};
			}

			try {
			
				$.ajax({
					url: action,
					type: method,
					data: data,
					contentType: false,
					processData: method.toLowerCase() == 'get',
					success: cb,
					error: err,
					dataType: 'JSON'
				});

			} catch(e) {}

		},

		initLink: function()
		{
			_this = this;

			$('body').on('click', _this.config.link_class, function(e) {
				e.preventDefault ? e.preventDefault() : e.returnValue = false;
				
				var link = $(this);

				if (link.data('is-busy')) {
					return;
				}

				link.data('is-busy', true);

				var action = ($(this).attr('href')) || $(this).data('action'),
					method = ($(this).data('method')) || 'get',
					data = {};

				_this.send(
					action,
					method,
					data,
					function(response)
					{
						if (link.data('callback') && _this.callback_stack.hasOwnProperty(link.data('callback')))
						{
							_this.callback_stack[link.data('callback')](link, response);
						}
						else
						{
							_this.default_handler(link, response);
						}

						if (response.status === true)
						{
							
						}

						link.data('is-busy', false);
					},
					function(response)
					{
						_this.default_handler(link, response);
						link.data('is-busy', false);
					}
				);
			});
		},

 		initForm: function()
        {
            _this = this;

            $('body').on('submit', _this.config.form_class, function(e) {
                e.preventDefault ? e.preventDefault() : e.returnValue = false;

                var form    = $(this),
                    action  = form.attr('action'),
                    method  = (form.attr('method') || 'post'),
                    data    = !!window.FormData ? new FormData(form[0]) : form.serialize();

                if (form.data('is-busy')) {
                    return;
                }

                form.data('is-busy', true);

                if (typeof button !== 'undefined')
                {
                    if (button.data('loading'))
                    {
                        button.data('original', button.text());
                        button.text(button.data('loading'));
                    }

                    button.addClass('preload');
                }

                if (form.data('precallback') && _this.callback_stack.hasOwnProperty(form.data('precallback'))) {
                    if(!_this.callback_stack[form.data('precallback')](form))
                    {
                        return false;
                    }
                }

                _this.send(
                    action,
                    method,
                    data,
                    function(response)
                    {
                        if (form.data('callback') && _this.callback_stack.hasOwnProperty(form.data('callback')))
                        {
                            _this.callback_stack[form.data('callback')](form, response);
                        }
                        else
                        {
                            _this.default_handler(form, response);
                        }

                        if (response.status === true)
                        {
                            if (form.hasClass(_this.config.form_reset))
                            {
                                form.find('.' + _this.config.error_class).removeClass(_this.config.error_class);
                                form.get(0).reset();
                            }
                        }

                        if (typeof button !== 'undefined')
                        {
                            if (button.data('original'))
                            {
                                button.text(button.data('original'));
                            }

                            button.removeClass('preload');
                        }

                        form.data('is-busy', false);
                    },
                    function(response)
                    {
                        _this.default_handler(form, response);
                        form.data('is-busy', false);
                    }
                );
            });
        },

		init: function(config)
		{
			this.extend(config);
			
			this.initForm();
			this.initLink();
		}
	};

	app.ajaxForm.init();

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.carousel = {

        init: function() {
            if ($('.j-carousel').length && $('.j-carousel').find('.slick-slide').length)
            {
                var count = 4, classname = 'carousel';

                $('.j-carousel').each(function(){
                    count = 4;
                    classname = 'carousel';

                    if ($(this).data('viewcount'))
                    {
                        count = parseInt($(this).data('viewcount'));
                    }

                    if ($(this).data('classname'))
                    {
                        classname = $(this).data('classname');
                    }

                    $(this).slick({
                        infinite: true,
                        dots: false,
                        draggable: true,
                        speed: 170,
                        slidesToShow: count,
                        slidesToScroll: 1,
                        prevArrow: '<button type="button" class="'+classname+'__navigation '+classname+'__navigation_prev slick-prev"></button>',
                        nextArrow: '<button type="button" class="'+classname+'__navigation '+classname+'__navigation_next slick-next"></button>',
                        responsive: [
                            {
                                breakpoint: 1024,
                                settings: {
                                    slidesToShow: 3,
                                    slidesToScroll: 3,
                                    infinite: true,
                                    dots: true
                                }
                            },
                            {
                                breakpoint: 600,
                                settings: {
                                    slidesToShow: 2,
                                    slidesToScroll: 2
                                }
                            },
                            {
                                breakpoint: 480,
                                settings: {
                                    slidesToShow: 1,
                                    slidesToScroll: 1
                                }
                            }
                        ]
                    });
                });
            }
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.dropdown = {

        init: function()
        {
            var $dropdown;

            $('body').on('click', '.j-dropdown-trigger', function(e){
                e.preventDefault();

                $dropdown = $(this).closest('.j-dropdown');

                if (!$dropdown.hasClass('is-open'))
                {
                    $dropdown.addClass('is-open');

                    setTimeout(function(){
                        $dropdown.addClass('is-animate');
                    }, 10);
                }
                else
                {
                    $dropdown.removeClass('is-animate');

                    setTimeout(function(){
                        $dropdown.removeClass('is-open');
                    }, 250);  
                }
            });
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.faq = {

        init: function() {
            $('body').on('click', '.j-faq-trigger', function(e){
                e.preventDefault();

                var $faq = $(this).closest('.j-faq');
                $faq.toggleClass('_open');

                return !1;
            });
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.fixmenu = {
        
        fixMenu: function($menu, t) {

            if (t >= (159)) {
                if (!$menu.hasClass('_sticked')) {
                    $menu.addClass('_sticked');
                }
            }
            else {
                if ($menu.hasClass('_sticked')) {
                    $menu.removeClass('_sticked');
                }
            }
            
        },

        init: function() {
            var $element = $('#navigation'),
                that = this;

            that.fixMenu($element, $(window).scrollTop());

            $(window).on('scroll', function(){
                that.fixMenu($element, $(window).scrollTop());
            });
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.gallery = {

        init: function() {

            if ($('.j-gallery').length) {
                $('.j-gallery').each(function(){
                    $(this).magnificPopup({
                        type: 'image',
                        delegate: 'a.zoom',
                        removalDelay: 500,
                        fixedContentPos: false,
                        closeOnBgClick: true,
                        gallery: {
                            enabled: true
                        },
                        callbacks: {
                             open: function() {
                                $('body').addClass('noscroll');
                             },
                             close: function() {
                                 $('body').removeClass('noscroll');
                             }
                        }
                    });
                });

                $('.popup-youtube, .popup-vimeo, .popup-gmaps').magnificPopup({
                    disableOn: 700,
                    type: 'iframe',
                    mainClass: 'mfp-fade',
                    removalDelay: 160,
                    preloader: false,
                    fixedContentPos: false
                });
            }
            
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.map = {
        
        _mapObject: null,

        _geoObject: null,

        getData: function($element) {
            var x, wrap_id = null, coords = null;

            if ($element.data('coords')) {
                coords = $element.data('coords').split(',');

                for (x in coords) {
                    coords[x] = $.trim(coords[x]);
                }

                if (coords.length !== 2) {
                    coords = null;
                }
            }

            if ($element.attr('id')) {
                wrap_id = $element.attr('id');
            }

            return {
                id: wrap_id,
                coords: coords
            }
        },

        drowMap: function($element) {
            
            var that = this, data = this.getData($element);

            ymaps.ready(function(){

                that._mapObject = new ymaps.Map(data.id, {
                    center: [data.coords[0], data.coords[1]],
                    zoom: 13,
                    controls: ['zoomControl', 'searchControl', 'typeSelector', 'fullscreenControl']
                });

                // "fullscreenControl" - кнопка разворачивания карты на весь экран control.FullscreenControl;
                // "geolocationControl" - кнопка определения местоположения пользователя control.GeolocationControl;
                // "routeEditor" - кнопка включения и отключения поведения "редактор маршрута" control.RouteEditor;
                // "rulerControl" - кнопка включения и отключения поведения "линейка" control.RulerControl;
                // "searchControl" - панель поиска control.SearchControl;
                // "trafficControl" - панель пробок control.TrafficControl;
                // "typeSelector" - панель переключения типа карты control.TypeSelector;
                // "zoomControl" - ползунок масштаба control.ZoomControl;
                // "smallMapDefaultSet" - базовый набор элементов управления, оптимизированный для карт небольшого размера и экранов телефонов. Состоит из элементов управления "zoomControl", "searchControl", "typeSelector", "geolocationControl" и "fullscreenControl". В этом наборе все элементы управления минимизированы до кнопок с пиктограммами.
                // "mediumMapDefaultSet" - набор элементов управления, оптимизированный для карт среднего размера и экранов планшетов. Помимо базового набора элементов управления (см. выше), добавляет дополнительно элементы управления "rulerControl" и "trafficControl".
                // "largeMapDefaultSet" - набор элементов управления, оптимизированный для карт большого размера и экранов десктопных компьютеров. Отличается от набора "mediumMapDefaultSet" наличием элемента управления "routeEditor" и отсутствием элемента управления "fullScreen";
                // "default" - набор элементов управления по умолчанию; синоним для набора "mediumMapDefaultSet".

                that._mapObject.behaviors.disable('scrollZoom');

                that._mapObject.controls.get('zoomControl').options.set('size', 'small');
                that._mapObject.controls.get('zoomControl').options.set('position', { right: 10, top: 50 });

                that._mapObject.geoObjects
                    .add(new ymaps.Placemark([data.coords[0], data.coords[1]], {}, {
                        preset: 'islands#dotIcon',
                        iconColor: '#735184'
                    }))

            });

        },

        init: function() {
            var that = this;

            if ($('.j-map').length) {
                $('.j-map').each(function(){
                    that.drowMap($(this));
                });
            }
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.morph = {

        init: function() {
            function morphDropdown( element ) {
                this.element = element;
                this.mainNavigation = this.element.find('.main-nav');
                this.mainNavigationItems = this.mainNavigation.find('.has-dropdown');
                this.dropdownList = this.element.find('.dropdown-list');
                //...
                
                this.bindEvents();
            }

            morphDropdown.prototype.bindEvents = function() {
                var self = this;
                
                this.mainNavigationItems.mouseenter(function(event){
                    //hover over one of the nav items -> show dropdown
                    self.showDropdown($(this));
                }).mouseleave(function(){
                    //if not hovering over a nav item or a dropdown -> hide dropdown
                    if( self.mainNavigation.find('.has-dropdown:hover').length == 0 && self.element.find('.dropdown-list:hover').length == 0 ) self.hideDropdown();
                });
            };

            morphDropdown.prototype.showDropdown = function(item) {
                var selectedDropdown = this.dropdownList.find('#'+item.data('content')),
                    selectedDropdownHeight = selectedDropdown.innerHeight(),
                    selectedDropdownWidth = selectedDropdown.children('.content').innerWidth(),
                    selectedDropdownLeft = item.offset().left + item.innerWidth()/2 - selectedDropdownWidth/2;
             
                //update dropdown and dropdown background position and size
                this.updateDropdown(selectedDropdown, parseInt(selectedDropdownHeight), selectedDropdownWidth, parseInt(selectedDropdownLeft));
                
                //add the .active class to the selected .dropdown and .is-dropdown-visible to the .cd-morph-dropdown 
                //...
            };
             
            morphDropdown.prototype.updateDropdown = function(dropdownItem, height, width, left) {
                this.dropdownList.css({
                    '-moz-transform': 'translateX(' + left + 'px)',
                    '-webkit-transform': 'translateX(' + left + 'px)',
                    '-ms-transform': 'translateX(' + left + 'px)',
                    '-o-transform': 'translateX(' + left + 'px)',
                    'transform': 'translateX(' + left + 'px)',
                    'width': width+'px',
                    'height': height+'px'
                });
             
                this.dropdownBg.css({
                    '-moz-transform': 'scaleX(' + width + ') scaleY(' + height + ')',
                    '-webkit-transform': 'scaleX(' + width + ') scaleY(' + height + ')',
                    '-ms-transform': 'scaleX(' + width + ') scaleY(' + height + ')',
                    '-o-transform': 'scaleX(' + width + ') scaleY(' + height + ')',
                    'transform': 'scaleX(' + width + ') scaleY(' + height + ')'
                });
            };

        }

    };

})(document.body);
(function($) {
    "use strict";

    var that, top, changeItem, scrollToAnchor, $target, $element, $current, $navigationMap, $navigation = $('#navigation'), $hasScroll = $('html, body');
    var is_mobile = $(window).width() <= 667;

    $navigationMap = $('.j-section').map(function(){
        return {
            offset: $(this).offset().top,
            element: $(this)
        }
    });

    changeItem = function(scrollTop) {
        $element = null;

        $navigationMap.map(function(){
            that = $(this)[0];
            if (that.offset < scrollTop) {
                $element = that.element; 
            }
        })

        if ($element !== null && $element.data('screen')) {
            $current = $navigation.find('.j-navigation[href="#' + $element.data('screen') + '"]');

            if (!$current.hasClass('_current')) {
                $navigation.find('.j-navigation._current').removeClass('_current');
                $current.addClass('_current');
            }
        }
    }

    scrollToAnchor = function(hash, animate) {
        $target = $(hash + '-anchor');

        if ($target.length)
        {
            is_mobile = $(window).width() <= 667;
            top = $target.offset().top;

            if (is_mobile) {
                top = top - 100
            }

            if (animate) {
                $hasScroll.stop().animate({ 'scrollTop': top }, 'medium', 'easeInOutCirc');
            }
            else {
                $hasScroll.scrollTop(top);
            }
        }
    }

    $('.j-navigation').on('click', function(e) {
        scrollToAnchor(this.hash, true);
    });

    setTimeout(function(){
        if (window.location.hash.length > 1) {
            scrollToAnchor(window.location.hash, false);
        }
    }, 150);

    $(window).scroll(function(){
        changeItem($(window).scrollTop())
    });
})(jQuery);
var app = app || {};

(function(body){
    "use strict";

    app.pageup = {

        element: null,

        click: function()
        {
            this.element.on('click', function(e){
                e.preventDefault();
                
                $('html, body').stop().animate({ scrollTop: 0 }, "fast");

                return !1;
            });
        },

        check: function(sctop)
        {
            var _this = this;

            if (sctop > 150)
            {
                if (!_this.element.hasClass('is-show'))
                {
                    _this.element.addClass('is-show');
                }

                if (!_this.element.hasClass('is-animate'))
                {
                    setTimeout(function(){
                        _this.element.addClass('is-animate');
                    }, 10);
                }
            }
            else
            {
                _this.element.removeClass('is-animate');

                setTimeout(function(){
                    _this.element.removeClass('is-show');
                }, 150);
            }
        },

        init: function()
        {
            var _this = this;

            _this.element = $('.j-page-up');

            _this.check($(window).scrollTop());

            $(window).on('scroll', function(){
                _this.check($(window).scrollTop());
            });

            _this.click();
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.preload = {

        preload: function($image)
        {
            var url = $image.data('preload'), image = null;

            try {
                image = new Image();
                image.onload = function() {
                    $image.attr('src', url);
                };
                image.src = url;
            }
            catch (e) {
                $image.attr('src', url);
            }
            
            $image.removeAttr('width height');
            $image.data('preload', '');
        },

        init: function()
        {
            if ($('img[data-preload]').length)
            {
                var _this = this;
            
                $('img[data-preload]').each(function(){
                    (function($image){
                        _this.preload($image);
                    })($(this))
                });
            }
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.quantity = {

        config: {
            element: '.j-quantity',
            input: '.j-quantity-count',
            control: '.j-quantity-control',
            complete: null
        },

        element: null,

        extend: function(config)
        {
            var _this = this;

            if (typeof config !== 'undefined')
            {
                var x;
                for (x in config)
                {
                    if (typeof _this.config[x] !== 'undefined')
                        _this.config[x] = config[x];
                }
            }
        },

        setValue: function(quantity)
        {
            var min = 1, max = 100;

            if (this.element.data('min')) {
                min = this.element.data('min');   
            }
            
            if (this.element.data('max')) {
                max = this.element.data('max');   
            }

            if (quantity > max) {
                quantity = max;
            }
            
            if (quantity < min) {
                quantity = min;
            }

            this.element.find(this.config.input).val(quantity);

        },

        increase: function(quantity)
        {
            quantity += 1;

            this.setValue(quantity);
        },

        decrease: function(quantity)
        {
            if (quantity > 1) {
                quantity -= 1;
            }

            this.setValue(quantity);
        },

        callback: function()
        {
            if (typeof(this.element.data('product')) !== 'undefined' && typeof(this.config.complete) == 'function')
            {
                this.config.complete.call(null, this.element, this.element.data('product'));
            }
        },

        keys: function()
        {
            var _this = this, role = '';

            $('body').on('keydown', _this.config.input, function(e) {
                if ([38, 40].indexOf(e.keyCode) >= 0)
                {
                    e.preventDefault();

                    role = {
                        38: 'increase',
                        40: 'decrease'
                    };

                    _this.element = $(this).closest(_this.config.element);

                    _this[role[e.keyCode]](parseInt(_this.element.find(_this.config.input).val()));

                    _this.callback();

                    return false;
                }
            });
        },

        bind: function()
        {
            var _this = this, role = '';

            $('body').on('click', _this.config.control, function(e) {
                e.preventDefault();

                _this.element = $(this).closest(_this.config.element);

                role = $(this).data('role');
         
                if(['increase', 'decrease'].indexOf(role) >= 0)
                {
                    _this[role](parseInt(_this.element.find(_this.config.input).val()));
                }

                _this.callback();

                return !1;
            });
        },

        init: function(config)
        {
            if (typeof config !== 'undefined')
            {
                this.extend(config);
            }

            this.bind();
            this.keys();
        }

    };

})(document.body);

// this.quantity.init({
//     complete: function(element, id) {
//         // $(element).css({
//         //     'border': '1px solid lime'
//         // });

//         console.log("id :", id);
//     }
// });

// <div class="quantity j-quantity clearfix" data-product="1000" data-min="1" data-max="999">
//     <button type="button" class="quantity__control _decrease j-quantity-control" data-role="decrease"></button>
//     <input type="text" name="count[1000]" value="1" data-role="quantity-input" class="quantity__count j-quantity-count" maxlength="3" autocomplete="off">
//     <button type="button" class="quantity__control _increase j-quantity-control" data-role="increase"></button>
// </div>
var app = app || {};

;(function(body){
    "use strict";

    var _this;

    app.sandwich = {

        config: {
            keyHooks: !1,
            selector: '.js-sandwich-menu',
            wrapper: '.layout-wrapper',
            overlay: '.overlay'
        },

        extend: function(config)
        {
            _this = this;

            if (typeof config !== 'undefined')
            {
                var x;
                for (x in config)
                {
                    if (typeof _this.config[x] !== 'undefined')
                        _this.config[x] = config[x];
                }
            }
        },

        isOpen: function()
        {
            return $('body').hasClass('page-visible');
        },

        hide: function()
        {
            $('body').removeClass('page-open');

            setTimeout(function(){
                $('body').removeClass('page-visible');
            }, 10);

            $(this.config.overlay).css({
                'visibility': 'hidden'
            });
        },

        toggle: function()
        {
            if ($('body').hasClass('page-visible'))
            {
                $('body').removeClass('page-open');

                setTimeout(function(){
                    $('body').removeClass('page-visible');
                }, 200);
            }
            else
            {
                $('body').addClass('page-open');

                setTimeout(function(){
                    $('body').addClass('page-visible');
                }, 10);
            }

            var visibility = 'visible';

            if (!$('body').hasClass('page-open'))
            {
                visibility = 'hidden'
            }
            
            $(_this.config.overlay).css({
                'visibility': visibility
            });
        },

        sandwichTrigger: function()
        {
            _this = this;

            if (_this.config.keyHooks)
            {
                $('body').on('keydown', function(e) {
                    if(e.keyCode == 27 && _this.isOpen())
                    {
                        _this.toggle();
                    }
                });
            };

            $('body').on('click', _this.config.selector, function(e){
                e.preventDefault ? e.preventDefault() : e.returnValue = false;
                _this.toggle();
            });
        },

        overlayTrigger: function()
        {
            _this = this;

            $('body').on('click', _this.config.overlay, function(e){
                _this.hide();
            });
        },

        init: function(config)
        {
            this.extend(config);
            this.sandwichTrigger();
            this.overlayTrigger();
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.shoppingCart = {

        config: {
            add: '.j-cart-add',
            remove: '.j-cart-remove',
            count: '.watch-cart-count',
            amount: '.watch-cart-amount',
            discount: '.watch-cart-discount',
            container: '.j-button-container',
            toggle_class: 'in-cart',
            product: function($item) {
                return parseInt($item.data('product'));
            },
            timeout: 50,
            callback: null
        },

        extend: function(config)
        {
            var _this = this;

            if (typeof config !== 'undefined')
            {
                var x;
                for (x in config)
                {
                    if (typeof _this.config[x] !== 'undefined')
                        _this.config[x] = config[x];
                }
            }
        },

        callback: function($item, response)
        {
            if (typeof(this.config.callback) == 'function')
            {
                this.config.callback.call(this, $item, response);
            }
            else
            {
                if (typeof response.count !== 'undefined')
                {
                    $(this.config.count).html(response.count);

                    if (response.count > 0)
                    {
                        $item.closest(this.config.container).addClass(this.config.toggle_class);
                    }
                    else
                    {
                        $item.closest(this.config.container).removeClass(this.config.toggle_class);
                    }
                }
                else
                {
                    $item.closest(this.config.container).removeClass(this.config.toggle_class);
                }
                
                if (typeof response.amount !== 'undefined')
                {   
                    $(this.config.amount).html(this.convertMoney(response.amount));
                }

                if (typeof response.remove !== 'undefined')
                {
                    $item.closest(this.config.container).removeClass(this.config.toggle_class);
                }

                setTimeout(function(){
                    $item.data('blocked', false);
                }, this.config.timeout);
            }
        },

        convertMoney: function(n)
        {
            var c = 0,
                d = '',
                t = ' ',
                s = n < 0 ? "-" : "",
                i = parseInt(n = Math.abs(+n || 0).toFixed(c)) + "",
                j = (j = i.length) > 3 ? j % 3 : 0;

            return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
        },

        bind: function()
        {
            var _this = this;

            $('body').on('click', [_this.config.remove, _this.config.add].join(','), function(e){
                e.preventDefault();

                if (!$(this).data('blocked'))
                {
                    _this.request($(this));   
                }

                return false;
            });
        },

        request: function($item)
        {
            var _this = this;
            
            $item.data('blocked', true);

            var data = {};
            var action = '';
            var method = 'GET';

            if ($item.data('method'))
            {
                method = $item.data('method');
            }
            
            if ($item.data('action'))
            {
                action = $item.data('action');
            }
            
            if (!action && $item.attr('href'))
            {
                action = $item.attr('href');
            }

            if ($item.data('product'))
            {
                data['product'] = this.config.product($item);
            }
            
            $.ajax({
                url: action,
                data: data,
                type: method,
                cache: false,
                dataType: 'JSON',
                success: function(response)
                {
                    _this.callback($item, response);
                },
                error: function(response)
                {
                    $item.data('blocked', false);
                    console.log('error: ', response)
                }
            });
        },

        init: function(config)
        {
            if (typeof config !== 'undefined')
            {
                this.extend(config);
            }

            this.bind();
        }

    };

})(document.body);

// this.shoppingCart.init({
//     add: '.j-shopping-cart-add',
//     remove: '.j-shopping-cart-remove'
// });

// <a href="/cart/remove?product=10&backuri=xx" data-action="/cart/remove" data-product="{$product.id}" data-method="POST|GET" class="button remove j-cart-remove" title="Удалить из корзины">Удалить из корзины</a>
// <a href="/cart/add?product=10&backuri=xx" data-action="/cart/remove" data-product="{$product.id}" data-method="POST|GET" class="button add j-cart-add" title="Добавить в корзину">Добавить в корзину</a>

var app = app || {};

(function(body){
    "use strict";

    app.slider = {

        init: function() {
            if ($('.j-slider').length && $('.j-slider').find('.slick-slide').length)
            {
                var count = 1, classname = 'slider', prefix = 'slider', $slider = '', width = $(window).width(), options = {};

                $('.j-slider').each(function(){
                    count = 1;
                    classname = 'slider';

                    if ($(this).data('prefix')) {
                        prefix = $(this).data('prefix');
                    }

                    options = {
                        fade: true,
                        dots: true,
                        speed: 500,
                        infinite: true,
                        autoplay: false,
                        draggable: false,
                        autoplaySpeed: 6500,
                        pauseOnHover: false,
                        useTransform: false,
                        variableWidth: false,
                        cssEase: 'linear',
                        responsive: [
                            {
                                breakpoint: 950,
                                settings: {
                                    dots: false,
                                    autoplay: true,
                                    draggable: true
                                }
                            }
                        ]
                    };
                    
                    $slider = $(this);

                    if ($slider.data('viewcount'))
                    {
                        count = parseInt($slider.data('viewcount'));
                    }

                    $slider.on('beforeChange', function(event, slick, currentSlide, nextSlide){
                        console.log(currentSlide, nextSlide);
                        
                        var $current = $(slick.$slides[currentSlide]);
                        var $next = $(slick.$slides[nextSlide]);
                        // $next.find('.j-after-slide').removeClass('is-show is-animate');
                    });

                    $slider.on('afterChange', function(event, slick, currentSlide){
                        var $current = $(slick.$slides[currentSlide]);
                        $current.find('.j-after-slide').addClass('is-show');
                        
                        setTimeout(function(){
                            $current.find('.j-after-slide').addClass('is-animate');
                        }, 10);
                    });

                    if ($slider.hasClass('j-slider-calc'))
                    {
                        $slider.find('.slick-slide').css({
                            'width': width + 'px'
                        });
                    }

                    if ($slider.data('classname'))
                    {
                        classname = $slider.data('classname');
                    }
                    
                    if (!$slider.hasClass('j-disable-navigation'))
                    {
                        options['prevArrow'] = '<button type="button" class="' + prefix + '__nav _prev slick-prev"></button>';
                        options['nextArrow'] = '<button type="button" class="' + prefix + '__nav _next slick-next"></button>';
                    }
                    else
                    {
                        options['arrows'] = false;
                    }

                    $slider.slick(options);
                });
            }
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.tabs = {

        init: function() {
            var $wrapper = null, tab = '';

            $('body').on('click', '.j-tab-trigger', function(e){
                e.preventDefault();

                if (!$(this).hasClass('_open')) {
                    tab = $(this).data('tab');

                    $wrapper = $(this).closest('.j-tab-wrapper');

                    $wrapper.find('.j-tab-trigger').removeClass('_current');
                    $wrapper.find('.j-tab-item').removeClass('_open');

                    $wrapper.find('#tab-'+tab).addClass('_open');
                    $(this).addClass('_current');
                }

                return !1;
            });
        }

    };

})(document.body);
var app = app || {};

(function(body){
    "use strict";

    app.toggle = {
        
        init: function() {
            
            var $toggle = null, text = '', hide = true, remove = false;

            $('body').on('click', '.j-toggle-trigger', function(e){
                e.preventDefault();

                $toggle = $(this).closest('.j-toggle').find('.j-toggle-item');

                if ($toggle)
                {
                    $toggle.toggleClass('is-show');
                }

                if ($toggle.hasClass('is-hidden'))
                {
                    $toggle.removeClass('is-hidden');
                }

                if ($(this).data('toggle-text')) {
                    text = $(this).data('toggle-text');
                }

                if (typeof($(this).data('remove')) !== 'undefined') {
                    remove = $(this).data('remove') == '0' ? false : ($(this).data('remove') == '1' ? true : false);
                }
                
                if (hide) {
                    $(this).hide();
                }
                
                if (remove) {
                    $(this).remove();
                }

                if (text) {
                    $(this).data('toggle-text', $(this).html());
                    $(this).html(text);
                }

                return false;
            })

        }

    };

})(document.body);

// <div class="j-toggle">
//     <div class="j-toggle-item"> content </div>
//     <span class="j-toggle-trigger" data-toggle-text="Скрыть..." data-hide="1" data-remove="1">Еще...</span>
// </div>
"use strict";

function sprintf(v) {
  var split = v.toString().split('.'), pad = "00", time = [], x = null;

  for (x in split) {
    time.push(pad.substring(0, 2 - split[x].toString().length) + split[x]);
  }

  return time.join('.');
}
$(document).ready(function() {
    app.init();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9fYXBwLmpzIiwiX2FwcC5hamF4LmpzIiwiX2FwcC5hamF4Zm9ybS5qcyIsIl9hcHAuY2Fyb3VzZWwuanMiLCJfYXBwLmRyb3Bkb3duLmpzIiwiX2FwcC5mYXEuanMiLCJfYXBwLmZpeG1lbnUuanMiLCJfYXBwLmdhbGxlcnkuanMiLCJfYXBwLm1hcC5qcyIsIl9hcHAubW9ycGguanMiLCJfYXBwLm5hdmlnYXRpb24uanMiLCJfYXBwLnBhZ2V1cC5qcyIsIl9hcHAucHJlbG9hZC5qcyIsIl9hcHAucXVhbnRpdHkuanMiLCJfYXBwLnNhbmR3aWNoLmpzIiwiX2FwcC5zaG9wcGluZy1jYXJ0LmpzIiwiX2FwcC5zbGlkZXIuanMiLCJfYXBwLnRhYnMuanMiLCJfYXBwLnRvZ2dsZS5qcyIsIl9mdW5jdGlvbnMuanMiLCJpbml0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwID0ge1xuICAgICAgICBcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmluaXQoKTtcbiAgICAgICAgICAgIC8vIHRoaXMubWFwLmluaXQoKTtcbiAgICAgICAgICAgIC8vIHRoaXMuZmFxLmluaXQoKTtcbiAgICAgICAgICAgIC8vIHRoaXMuZmFxLm1vcnBoKCk7XG4gICAgICAgICAgICAvLyB0aGlzLmZpeG1lbnUuaW5pdCgpO1xuICAgICAgICAgICAgLy8gdGhpcy5hamF4Rm9ybS5pbml0KCk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpOyIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciAkYm9keSA9ICQoJ2JvZHknKSxcbiAgICAgICAgX3RoaXM7XG5cbiAgICBhcHAuYWpheEZvcm0gPSB7XG5cbiAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICBmb3JtX2NsYXNzOiAnLmZvcm0tYWpheCcsXG4gICAgICAgICAgICBmb3JtX3Jlc2V0OiAnZm9ybS1yZXNldCcsXG4gICAgICAgICAgICBsaW5rX2NsYXNzOiAnLmpzLXJlcXVlc3QtbGluaycsXG4gICAgICAgICAgICBlcnJvcl9jbGFzczogJ2Vycm9yJyxcbiAgICAgICAgICAgIGVycm9yX21lc3NhZ2U6ICdmb3JtX19lcnJvci1tZXNzYWdlJyxcbiAgICAgICAgICAgIGVycm9yX21lc3NhZ2VfY2xhc3M6ICdqLWVycm9yLW1lc3NhZ2UnLFxuICAgICAgICAgICAgZXJyb3JfbWVzc2FnZV9hZGRjbGFzczogJ3Nob3cnLFxuICAgICAgICAgICAgZm9ybV9sYWJlbDogJy5mb3JtX193cmFwcGVyJyxcbiAgICAgICAgICAgIGNoZWNrYm94X2xhYmVsOiAnY2hlY2tib3hfX2xhYmVsJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGNhbGxiYWNrX3N0YWNrOiB7fSxcblxuICAgICAgICBleHRlbmQ6IGZ1bmN0aW9uKGNvbmZpZylcbiAgICAgICAge1xuICAgICAgICAgICAgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIHg7XG4gICAgICAgICAgICAgICAgZm9yICh4IGluIGNvbmZpZylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgX3RoaXMuY29uZmlnW3hdICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbmZpZ1t4XSA9IGNvbmZpZ1t4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVmYXVsdF9oYW5kbGVyOiBmdW5jdGlvbihmb3JtLCByZXNwb25zZSlcbiAgICAgICAge1xuICAgICAgICAgICAgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVkaXJlY3RfdXJsJykpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJlc3BvbnNlLnJlZGlyZWN0X3VybDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgcmVzcG9uc2UuZXJyb3JzICE9PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgcmVzcG9uc2UuZXJyb3JfbWVzc2FnZSAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9ycywgZXJyb3JfbWVzc2FnZTtcblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzcG9uc2UuZXJyb3JzICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9ycyA9IHJlc3BvbnNlLmVycm9ycztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3BvbnNlLmVycm9yX21lc3NhZ2UgIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbWVzc2FnZSA9IHJlc3BvbnNlLmVycm9yX21lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX3RoaXMudmFsaWRhdGlvbihmb3JtLCBlcnJvcnMsIHJlc3BvbnNlLmVycm9yX21lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ29wZW5fcG9wdXAnKSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZiAoJCgnYm9keScpLmZpbmQoJy5wb3B1cC5pcy1vcGVuJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgJC5wb3B1cC5jbG9zZSgkKCdib2R5JykuZmluZCgnLnBvcHVwLmlzLW9wZW4nKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICQucG9wdXAub3BlbihyZXNwb25zZS5vcGVuX3BvcHVwKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICQucG9wdXAub3BlbihyZXNwb25zZS5vcGVuX3BvcHVwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnbWVzc2FnZScpKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICQucG9wdXAubWVzc2FnZShyZXNwb25zZS50aXRsZSwgcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICB2YWxpZGF0aW9uOiBmdW5jdGlvbihmb3JtLCBlcnJvcnMsIGVycm9yX21lc3NhZ2UpXG4gICAgICAgIHtcbiAgICAgICAgICAgIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgZm9ybS5maW5kKCcuJyArIF90aGlzLmNvbmZpZy5lcnJvcl9jbGFzcykucmVtb3ZlQ2xhc3MoX3RoaXMuY29uZmlnLmVycm9yX2NsYXNzKTtcbiAgICAgICAgICAgIGZvcm0uZmluZCgnLicgKyBfdGhpcy5jb25maWcuZXJyb3JfbWVzc2FnZSkucmVtb3ZlKCk7XG4gICAgICAgICAgICBmb3JtLmZpbmQoJy4nICsgX3RoaXMuY29uZmlnLmVycm9yX21lc3NhZ2VfY2xhc3MpLnJlbW92ZUNsYXNzKF90aGlzLmNvbmZpZy5lcnJvcl9tZXNzYWdlX2FkZGNsYXNzKTtcblxuICAgICAgICAgICAgdmFyIGZpZWxkTmFtZSwgZmllbGQ7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlcnJvcl9tZXNzYWdlICE9PSAndW5kZWZpbmVkJyAmJiBlcnJvcl9tZXNzYWdlICE9PSAnJylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm0uZmluZCgnLicgKyBfdGhpcy5jb25maWcuZXJyb3JfbWVzc2FnZV9jbGFzcykuaHRtbChlcnJvcl9tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgZm9ybS5maW5kKCcuJyArIF90aGlzLmNvbmZpZy5lcnJvcl9tZXNzYWdlX2NsYXNzKS5hZGRDbGFzcyhfdGhpcy5jb25maWcuZXJyb3JfbWVzc2FnZV9hZGRjbGFzcyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlcnJvcnMgIT09ICd1bmRlZmluZWQnICYmIGVycm9ycyAhPT0gJycpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmb3IoZmllbGROYW1lIGluIGVycm9ycylcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIicrZmllbGROYW1lKydcIl0nKS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwiJytmaWVsZE5hbWUrJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybS5maW5kKCdzZWxlY3RbbmFtZT1cIicrZmllbGROYW1lKydcIl0nKS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gZm9ybS5maW5kKCdzZWxlY3RbbmFtZT1cIicrZmllbGROYW1lKydcIl0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm0uZmluZCgndGV4dGFyZWFbbmFtZT1cIicrZmllbGROYW1lKydcIl0nKS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gZm9ybS5maW5kKCd0ZXh0YXJlYVtuYW1lPVwiJytmaWVsZE5hbWUrJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQuY2xvc2VzdCgnLicgKyBfdGhpcy5jb25maWcuY2hlY2tib3hfbGFiZWwpLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBmaWVsZC5jbG9zZXN0KCcuJyArIF90aGlzLmNvbmZpZy5jaGVja2JveF9sYWJlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGQgIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmFkZENsYXNzKF90aGlzLmNvbmZpZy5lcnJvcl9jbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuY2xvc2VzdChfdGhpcy5jb25maWcuZm9ybV9sYWJlbCkuYXBwZW5kKCc8ZGl2IGNsYXNzPVwiJyArIF90aGlzLmNvbmZpZy5lcnJvcl9tZXNzYWdlICsgJ1wiPicgKyBlcnJvcnNbZmllbGROYW1lXSArICc8L2Rpdj4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgfSxcblxuICAgICAgICB1cGxvYWQ6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICAkYm9keS5vbignc3VibWl0JywgJy5mb3JtLWZpbGUtdXBsb2FkJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBBSU0uc3VibWl0KHRoaXMsIHtcbiAgICAgICAgICAgICAgICAgICAgb25TdGFydDogZnVuY3Rpb24oKVxuICAgICAgICAgICAgICAgICAgICB7XG5cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24ocmVzdWx0KVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gJ29iamVjdCcgJiYgcmVzdWx0LnN0YXR1cyA9PT0gdHJ1ZSAmJiByZXN1bHQuaGFzT3duUHJvcGVydHkoJ3Bob3RvX3VybCcpKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbignY2hhbmdlJywgJy51cGxvYWRfYnV0dG9uX29uY2hhbmdlJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5jbG9zZXN0KCcudXBsb2FkX2J1dHRvbicpLmZpbmQoJy51cGxvYWRfYnV0dG9uX2ZpZWxkJykubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnLnVwbG9hZF9idXR0b24nKS5maW5kKCcudXBsb2FkX2J1dHRvbl9maWVsZCcpLmh0bWwoJCh0aGlzKS52YWwoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2VuZDogZnVuY3Rpb24oYWN0aW9uLCBtZXRob2QsIGRhdGEsIGNiLCBlcnIpXG4gICAgICAgIHtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjYiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGNiID0gZnVuY3Rpb24oKSB7fTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBlcnIgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlcnIgPSBmdW5jdGlvbigpIHt9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0cnkge1xuXG4gICAgICAgICAgICAgICAgJC5hamF4U2V0dXAoe1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnWC1DU1JGLVRPS0VOJzogJCgnbWV0YVtuYW1lPVwiY3NyZi10b2tlblwiXScpLmF0dHIoJ2NvbnRlbnQnKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IGFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogbWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBtZXRob2QudG9Mb3dlckNhc2UoKSA9PSAnZ2V0JyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogY2IsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBlcnIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnSlNPTidcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSBjYXRjaChlKXt9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBpbml0TGluazogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgICRib2R5Lm9uKCdjbGljaycsIF90aGlzLmNvbmZpZy5saW5rX2NsYXNzLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCA/IGUucHJldmVudERlZmF1bHQoKSA6IGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIHZhciBsaW5rID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgIGlmIChsaW5rLmRhdGEoJ2lzLWJ1c3knKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGluay5kYXRhKCdpcy1idXN5JywgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gKCQodGhpcykuYXR0cignaHJlZicpKSB8fCAkKHRoaXMpLmRhdGEoJ2FjdGlvbicpLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSAoJCh0aGlzKS5kYXRhKCdtZXRob2QnKSkgfHwgJ2dldCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSB7fTtcblxuICAgICAgICAgICAgICAgIF90aGlzLnNlbmQoXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXNwb25zZSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmsuZGF0YSgnY2FsbGJhY2snKSAmJiBfdGhpcy5jYWxsYmFja19zdGFjay5oYXNPd25Qcm9wZXJ0eShsaW5rLmRhdGEoJ2NhbGxiYWNrJykpKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNhbGxiYWNrX3N0YWNrW2xpbmsuZGF0YSgnY2FsbGJhY2snKV0obGluaywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRlZmF1bHRfaGFuZGxlcihsaW5rLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgbGluay5kYXRhKCdpcy1idXN5JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXNwb25zZSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZGVmYXVsdF9oYW5kbGVyKGxpbmssIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsuZGF0YSgnaXMtYnVzeScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0Rm9ybTogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgICRib2R5Lm9uKCdzdWJtaXQnLCBfdGhpcy5jb25maWcuZm9ybV9jbGFzcywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQgPyBlLnByZXZlbnREZWZhdWx0KCkgOiBlLnJldHVyblZhbHVlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB2YXIgZm9ybSAgICA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbiAgPSBmb3JtLmF0dHIoJ2FjdGlvbicpLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2QgID0gKGZvcm0uYXR0cignbWV0aG9kJykgfHwgJ3Bvc3QnKSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YSAgICA9ICEhd2luZG93LkZvcm1EYXRhID8gbmV3IEZvcm1EYXRhKGZvcm1bMF0pIDogZm9ybS5zZXJpYWxpemUoKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb3JtLmRhdGEoJ2lzLWJ1c3knKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9ybS5kYXRhKCdpcy1idXN5JywgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGJ1dHRvbiAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYnV0dG9uLmRhdGEoJ2xvYWRpbmcnKSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmRhdGEoJ29yaWdpbmFsJywgYnV0dG9uLnRleHQoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24udGV4dChidXR0b24uZGF0YSgnbG9hZGluZycpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5hZGRDbGFzcygncHJlbG9hZCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChmb3JtLmRhdGEoJ3ByZWNhbGxiYWNrJykgJiYgX3RoaXMuY2FsbGJhY2tfc3RhY2suaGFzT3duUHJvcGVydHkoZm9ybS5kYXRhKCdwcmVjYWxsYmFjaycpKSkge1xuICAgICAgICAgICAgICAgICAgICBpZighX3RoaXMuY2FsbGJhY2tfc3RhY2tbZm9ybS5kYXRhKCdwcmVjYWxsYmFjaycpXShmb3JtKSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX3RoaXMuc2VuZChcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybS5kYXRhKCdjYWxsYmFjaycpICYmIF90aGlzLmNhbGxiYWNrX3N0YWNrLmhhc093blByb3BlcnR5KGZvcm0uZGF0YSgnY2FsbGJhY2snKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2FsbGJhY2tfc3RhY2tbZm9ybS5kYXRhKCdjYWxsYmFjaycpXShmb3JtLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZGVmYXVsdF9oYW5kbGVyKGZvcm0sIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybS5oYXNDbGFzcyhfdGhpcy5jb25maWcuZm9ybV9yZXNldCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmZpbmQoJy4nICsgX3RoaXMuY29uZmlnLmVycm9yX2NsYXNzKS5yZW1vdmVDbGFzcyhfdGhpcy5jb25maWcuZXJyb3JfY2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmdldCgwKS5yZXNldCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBidXR0b24gIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidXR0b24uZGF0YSgnb3JpZ2luYWwnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi50ZXh0KGJ1dHRvbi5kYXRhKCdvcmlnaW5hbCcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24ucmVtb3ZlQ2xhc3MoJ3ByZWxvYWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5kYXRhKCdpcy1idXN5JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXNwb25zZSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZGVmYXVsdF9oYW5kbGVyKGZvcm0sIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uZGF0YSgnaXMtYnVzeScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbihjb25maWcpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuZXh0ZW5kKGNvbmZpZyk7XG5cbiAgICAgICAgICAgIHRoaXMuaW5pdEZvcm0oKTtcbiAgICAgICAgICAgIHRoaXMuaW5pdExpbmsoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpOyIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuXHR2YXIgX3RoaXM7XG5cblx0YXBwLmFqYXhGb3JtID0ge1xuXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgZm9ybV9jbGFzczogJy5mb3JtLWFqYXgnLFxuICAgICAgICAgICAgZm9ybV9yZXNldDogJ2Zvcm0tcmVzZXQnLFxuICAgICAgICAgICAgbGlua19jbGFzczogJy5qcy1yZXF1ZXN0LWxpbmsnLFxuICAgICAgICAgICAgZXJyb3JfY2xhc3M6ICdlcnJvcicsXG4gICAgICAgICAgICBlcnJvcl9tZXNzYWdlOiAnZm9ybV9fZXJyb3ItbWVzc2FnZScsXG4gICAgICAgICAgICBlcnJvcl9tZXNzYWdlX2NsYXNzOiAnai1lcnJvci1tZXNzYWdlJyxcbiAgICAgICAgICAgIGVycm9yX21lc3NhZ2VfYWRkY2xhc3M6ICdzaG93JyxcbiAgICAgICAgICAgIGZvcm1fbGFiZWw6ICcuZm9ybV9fd3JhcHBlcicsXG4gICAgICAgICAgICBjaGVja2JveF9sYWJlbDogJ2NoZWNrYm94X19sYWJlbCdcbiAgICAgICAgfSxcblxuXHRcdGNhbGxiYWNrX3N0YWNrOiB7fSxcblxuXHRcdGV4dGVuZDogZnVuY3Rpb24oY29uZmlnKVxuXHRcdHtcblx0XHRcdF90aGlzID0gdGhpcztcblxuXHRcdFx0aWYgKHR5cGVvZiBjb25maWcgIT09ICd1bmRlZmluZWQnKVxuXHRcdFx0e1xuXHRcdFx0XHR2YXIgeDtcblx0XHRcdFx0Zm9yICh4IGluIGNvbmZpZylcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgX3RoaXMuY29uZmlnW3hdICE9PSAndW5kZWZpbmVkJylcblx0XHRcdFx0XHRcdF90aGlzLmNvbmZpZ1t4XSA9IGNvbmZpZ1t4XTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRkZWZhdWx0X2hhbmRsZXI6IGZ1bmN0aW9uKGZvcm0sIHJlc3BvbnNlKVxuXHRcdHtcblx0XHRcdF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3JlZGlyZWN0X3VybCcpKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZXNwb25zZS5yZWRpcmVjdF91cmw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHJlc3BvbnNlLmVycm9ycyAhPT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHJlc3BvbnNlLmVycm9yX21lc3NhZ2UgIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvcnMsIGVycm9yX21lc3NhZ2U7XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3BvbnNlLmVycm9ycyAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBlcnJvcnMgPSByZXNwb25zZS5lcnJvcnM7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXNwb25zZS5lcnJvcl9tZXNzYWdlICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yX21lc3NhZ2UgPSByZXNwb25zZS5lcnJvcl9tZXNzYWdlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIF90aGlzLnZhbGlkYXRpb24oZm9ybSwgZXJyb3JzLCBlcnJvcl9tZXNzYWdlKTtcbiAgICAgICAgICAgIH1cblx0XHRcdFxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdydW5fc2NyaXB0JykpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZih3aW5kb3dbcmVzcG9uc2UucnVuX3NjcmlwdF0pID09ICdmdW5jdGlvbicpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3dbcmVzcG9uc2UucnVuX3NjcmlwdF0oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnb3Blbl9wb3B1cCcpKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgXHRpZiAoJCgnYm9keScpLmZpbmQoJy5wb3B1cC5pcy1vcGVuJykubGVuZ3RoKVxuICAgICAgICAgICAgXHR7XG4gICAgICAgICAgICBcdFx0JC5wb3B1cC5jbG9zZSgkKCdib2R5JykuZmluZCgnLnBvcHVwLmlzLW9wZW4nKSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIFx0XHRcdCQucG9wdXAub3BlbihyZXNwb25zZS5vcGVuX3BvcHVwKTtcbiAgICAgICAgICAgIFx0XHR9KTtcbiAgICAgICAgICAgIFx0fVxuICAgICAgICAgICAgXHRlbHNlXG4gICAgICAgICAgICBcdHtcbiAgICAgICAgICAgIFx0XHQkLnBvcHVwLm9wZW4ocmVzcG9uc2Uub3Blbl9wb3B1cCk7XG4gICAgICAgICAgICBcdH1cbiAgICAgICAgICAgIH1cblxuXHRcdFx0aWYgKHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdtZXNzYWdlJykpXG5cdFx0XHR7XG5cdFx0XHRcdCQucG9wdXAubWVzc2FnZShyZXNwb25zZS50aXRsZSwgcmVzcG9uc2UubWVzc2FnZSk7XG5cdFx0XHR9XG5cblx0XHR9LFxuXG5cdFx0dmFsaWRhdGlvbjogZnVuY3Rpb24oZm9ybSwgZXJyb3JzLCBlcnJvcl9tZXNzYWdlKVxuICAgICAgICB7XG4gICAgICAgICAgICBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGZvcm0uZmluZCgnLicgKyBfdGhpcy5jb25maWcuZXJyb3JfY2xhc3MpLnJlbW92ZUNsYXNzKF90aGlzLmNvbmZpZy5lcnJvcl9jbGFzcyk7XG4gICAgICAgICAgICBmb3JtLmZpbmQoJy4nICsgX3RoaXMuY29uZmlnLmVycm9yX21lc3NhZ2VfY2xhc3MpLnJlbW92ZUNsYXNzKF90aGlzLmNvbmZpZy5lcnJvcl9tZXNzYWdlX2FkZGNsYXNzKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIGZpZWxkTmFtZSwgZmllbGQ7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlcnJvcl9tZXNzYWdlICE9PSAndW5kZWZpbmVkJyAmJiBlcnJvcl9tZXNzYWdlICE9PSAnJylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm0uZmluZCgnLicgKyBfdGhpcy5jb25maWcuZXJyb3JfbWVzc2FnZV9jbGFzcykuaHRtbChlcnJvcl9tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgZm9ybS5maW5kKCcuJyArIF90aGlzLmNvbmZpZy5lcnJvcl9tZXNzYWdlX2NsYXNzKS5hZGRDbGFzcyhfdGhpcy5jb25maWcuZXJyb3JfbWVzc2FnZV9hZGRjbGFzcyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlcnJvcnMgIT09ICd1bmRlZmluZWQnICYmIGVycm9ycyAhPT0gJycpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmb3IoZmllbGROYW1lIGluIGVycm9ycylcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIicrZmllbGROYW1lKydcIl0nKS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwiJytmaWVsZE5hbWUrJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybS5maW5kKCdzZWxlY3RbbmFtZT1cIicrZmllbGROYW1lKydcIl0nKS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gZm9ybS5maW5kKCdzZWxlY3RbbmFtZT1cIicrZmllbGROYW1lKydcIl0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm0uZmluZCgndGV4dGFyZWFbbmFtZT1cIicrZmllbGROYW1lKydcIl0nKS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gZm9ybS5maW5kKCd0ZXh0YXJlYVtuYW1lPVwiJytmaWVsZE5hbWUrJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQuY2xvc2VzdCgnLicgKyBfdGhpcy5jb25maWcuY2hlY2tib3hfbGFiZWwpLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBmaWVsZC5jbG9zZXN0KCcuJyArIF90aGlzLmNvbmZpZy5jaGVja2JveF9sYWJlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGQgIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmFkZENsYXNzKF90aGlzLmNvbmZpZy5lcnJvcl9jbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuY2xvc2VzdChfdGhpcy5jb25maWcuZm9ybV9sYWJlbCkuYXBwZW5kKCc8ZGl2IGNsYXNzPVwiJyArIF90aGlzLmNvbmZpZy5lcnJvcl9tZXNzYWdlICsgJ1wiPicgKyBlcnJvcnNbZmllbGROYW1lXSArICc8L2Rpdj4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgfSxcblxuXHRcdHVwbG9hZDogZnVuY3Rpb24oKVxuXHRcdHtcblx0XHRcdF90aGlzID0gdGhpcztcblxuXHRcdFx0JCgnYm9keScpLm9uKCdzdWJtaXQnLCAnLmZvcm0tZmlsZS11cGxvYWQnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHJldHVybiBBSU0uc3VibWl0KHRoaXMsIHtcblx0XHRcdFx0XHRvblN0YXJ0OiBmdW5jdGlvbigpXG5cdFx0XHRcdFx0e1xuXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRvbkNvbXBsZXRlOiBmdW5jdGlvbihyZXN1bHQpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZiByZXN1bHQgPT09ICdvYmplY3QnICYmIHJlc3VsdC5zdGF0dXMgPT09IHRydWUgJiYgcmVzdWx0Lmhhc093blByb3BlcnR5KCdwaG90b191cmwnKSlcblx0XHRcdFx0XHRcdHtcblxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0JChkb2N1bWVudCkub24oJ2NoYW5nZScsICcudXBsb2FkX2J1dHRvbl9vbmNoYW5nZScsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdGlmICgkKHRoaXMpLmNsb3Nlc3QoJy51cGxvYWRfYnV0dG9uJykuZmluZCgnLnVwbG9hZF9idXR0b25fZmllbGQnKS5sZW5ndGggPiAwKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0JCh0aGlzKS5jbG9zZXN0KCcudXBsb2FkX2J1dHRvbicpLmZpbmQoJy51cGxvYWRfYnV0dG9uX2ZpZWxkJykuaHRtbCgkKHRoaXMpLnZhbCgpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdHNlbmQ6IGZ1bmN0aW9uKGFjdGlvbiwgbWV0aG9kLCBkYXRhLCBjYiwgZXJyKVxuXHRcdHtcblxuXHRcdFx0aWYgKHR5cGVvZiBjYiAhPT0gJ2Z1bmN0aW9uJylcblx0XHRcdHtcblx0XHRcdFx0Y2IgPSBmdW5jdGlvbigpIHt9O1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIGVyciAhPT0gJ2Z1bmN0aW9uJylcblx0XHRcdHtcblx0XHRcdFx0ZXJyID0gZnVuY3Rpb24oKSB7fTtcblx0XHRcdH1cblxuXHRcdFx0dHJ5IHtcblx0XHRcdFxuXHRcdFx0XHQkLmFqYXgoe1xuXHRcdFx0XHRcdHVybDogYWN0aW9uLFxuXHRcdFx0XHRcdHR5cGU6IG1ldGhvZCxcblx0XHRcdFx0XHRkYXRhOiBkYXRhLFxuXHRcdFx0XHRcdGNvbnRlbnRUeXBlOiBmYWxzZSxcblx0XHRcdFx0XHRwcm9jZXNzRGF0YTogbWV0aG9kLnRvTG93ZXJDYXNlKCkgPT0gJ2dldCcsXG5cdFx0XHRcdFx0c3VjY2VzczogY2IsXG5cdFx0XHRcdFx0ZXJyb3I6IGVycixcblx0XHRcdFx0XHRkYXRhVHlwZTogJ0pTT04nXG5cdFx0XHRcdH0pO1xuXG5cdFx0XHR9IGNhdGNoKGUpIHt9XG5cblx0XHR9LFxuXG5cdFx0aW5pdExpbms6IGZ1bmN0aW9uKClcblx0XHR7XG5cdFx0XHRfdGhpcyA9IHRoaXM7XG5cblx0XHRcdCQoJ2JvZHknKS5vbignY2xpY2snLCBfdGhpcy5jb25maWcubGlua19jbGFzcywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0ID8gZS5wcmV2ZW50RGVmYXVsdCgpIDogZS5yZXR1cm5WYWx1ZSA9IGZhbHNlO1xuXHRcdFx0XHRcblx0XHRcdFx0dmFyIGxpbmsgPSAkKHRoaXMpO1xuXG5cdFx0XHRcdGlmIChsaW5rLmRhdGEoJ2lzLWJ1c3knKSkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGxpbmsuZGF0YSgnaXMtYnVzeScsIHRydWUpO1xuXG5cdFx0XHRcdHZhciBhY3Rpb24gPSAoJCh0aGlzKS5hdHRyKCdocmVmJykpIHx8ICQodGhpcykuZGF0YSgnYWN0aW9uJyksXG5cdFx0XHRcdFx0bWV0aG9kID0gKCQodGhpcykuZGF0YSgnbWV0aG9kJykpIHx8ICdnZXQnLFxuXHRcdFx0XHRcdGRhdGEgPSB7fTtcblxuXHRcdFx0XHRfdGhpcy5zZW5kKFxuXHRcdFx0XHRcdGFjdGlvbixcblx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0ZGF0YSxcblx0XHRcdFx0XHRmdW5jdGlvbihyZXNwb25zZSlcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRpZiAobGluay5kYXRhKCdjYWxsYmFjaycpICYmIF90aGlzLmNhbGxiYWNrX3N0YWNrLmhhc093blByb3BlcnR5KGxpbmsuZGF0YSgnY2FsbGJhY2snKSkpXG5cdFx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRcdF90aGlzLmNhbGxiYWNrX3N0YWNrW2xpbmsuZGF0YSgnY2FsbGJhY2snKV0obGluaywgcmVzcG9uc2UpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRfdGhpcy5kZWZhdWx0X2hhbmRsZXIobGluaywgcmVzcG9uc2UpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09PSB0cnVlKVxuXHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0bGluay5kYXRhKCdpcy1idXN5JywgZmFsc2UpO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0ZnVuY3Rpb24ocmVzcG9uc2UpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0X3RoaXMuZGVmYXVsdF9oYW5kbGVyKGxpbmssIHJlc3BvbnNlKTtcblx0XHRcdFx0XHRcdGxpbmsuZGF0YSgnaXMtYnVzeScsIGZhbHNlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdCk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG4gXHRcdGluaXRGb3JtOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdzdWJtaXQnLCBfdGhpcy5jb25maWcuZm9ybV9jbGFzcywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQgPyBlLnByZXZlbnREZWZhdWx0KCkgOiBlLnJldHVyblZhbHVlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB2YXIgZm9ybSAgICA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbiAgPSBmb3JtLmF0dHIoJ2FjdGlvbicpLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2QgID0gKGZvcm0uYXR0cignbWV0aG9kJykgfHwgJ3Bvc3QnKSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YSAgICA9ICEhd2luZG93LkZvcm1EYXRhID8gbmV3IEZvcm1EYXRhKGZvcm1bMF0pIDogZm9ybS5zZXJpYWxpemUoKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb3JtLmRhdGEoJ2lzLWJ1c3knKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9ybS5kYXRhKCdpcy1idXN5JywgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGJ1dHRvbiAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYnV0dG9uLmRhdGEoJ2xvYWRpbmcnKSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmRhdGEoJ29yaWdpbmFsJywgYnV0dG9uLnRleHQoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24udGV4dChidXR0b24uZGF0YSgnbG9hZGluZycpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5hZGRDbGFzcygncHJlbG9hZCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChmb3JtLmRhdGEoJ3ByZWNhbGxiYWNrJykgJiYgX3RoaXMuY2FsbGJhY2tfc3RhY2suaGFzT3duUHJvcGVydHkoZm9ybS5kYXRhKCdwcmVjYWxsYmFjaycpKSkge1xuICAgICAgICAgICAgICAgICAgICBpZighX3RoaXMuY2FsbGJhY2tfc3RhY2tbZm9ybS5kYXRhKCdwcmVjYWxsYmFjaycpXShmb3JtKSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX3RoaXMuc2VuZChcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybS5kYXRhKCdjYWxsYmFjaycpICYmIF90aGlzLmNhbGxiYWNrX3N0YWNrLmhhc093blByb3BlcnR5KGZvcm0uZGF0YSgnY2FsbGJhY2snKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2FsbGJhY2tfc3RhY2tbZm9ybS5kYXRhKCdjYWxsYmFjaycpXShmb3JtLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZGVmYXVsdF9oYW5kbGVyKGZvcm0sIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybS5oYXNDbGFzcyhfdGhpcy5jb25maWcuZm9ybV9yZXNldCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmZpbmQoJy4nICsgX3RoaXMuY29uZmlnLmVycm9yX2NsYXNzKS5yZW1vdmVDbGFzcyhfdGhpcy5jb25maWcuZXJyb3JfY2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmdldCgwKS5yZXNldCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBidXR0b24gIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidXR0b24uZGF0YSgnb3JpZ2luYWwnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi50ZXh0KGJ1dHRvbi5kYXRhKCdvcmlnaW5hbCcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24ucmVtb3ZlQ2xhc3MoJ3ByZWxvYWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5kYXRhKCdpcy1idXN5JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXNwb25zZSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZGVmYXVsdF9oYW5kbGVyKGZvcm0sIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uZGF0YSgnaXMtYnVzeScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuXHRcdGluaXQ6IGZ1bmN0aW9uKGNvbmZpZylcblx0XHR7XG5cdFx0XHR0aGlzLmV4dGVuZChjb25maWcpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmluaXRGb3JtKCk7XG5cdFx0XHR0aGlzLmluaXRMaW5rKCk7XG5cdFx0fVxuXHR9O1xuXG5cdGFwcC5hamF4Rm9ybS5pbml0KCk7XG5cbn0pKGRvY3VtZW50LmJvZHkpOyIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIGFwcC5jYXJvdXNlbCA9IHtcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICgkKCcuai1jYXJvdXNlbCcpLmxlbmd0aCAmJiAkKCcuai1jYXJvdXNlbCcpLmZpbmQoJy5zbGljay1zbGlkZScpLmxlbmd0aClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgY291bnQgPSA0LCBjbGFzc25hbWUgPSAnY2Fyb3VzZWwnO1xuXG4gICAgICAgICAgICAgICAgJCgnLmotY2Fyb3VzZWwnKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50ID0gNDtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NuYW1lID0gJ2Nhcm91c2VsJztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKCd2aWV3Y291bnQnKSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQgPSBwYXJzZUludCgkKHRoaXMpLmRhdGEoJ3ZpZXdjb3VudCcpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmRhdGEoJ2NsYXNzbmFtZScpKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc25hbWUgPSAkKHRoaXMpLmRhdGEoJ2NsYXNzbmFtZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5zbGljayh7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZpbml0ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvdHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3BlZWQ6IDE3MCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1RvU2hvdzogY291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNUb1Njcm9sbDogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZBcnJvdzogJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiJytjbGFzc25hbWUrJ19fbmF2aWdhdGlvbiAnK2NsYXNzbmFtZSsnX19uYXZpZ2F0aW9uX3ByZXYgc2xpY2stcHJldlwiPjwvYnV0dG9uPicsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0QXJyb3c6ICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cIicrY2xhc3NuYW1lKydfX25hdmlnYXRpb24gJytjbGFzc25hbWUrJ19fbmF2aWdhdGlvbl9uZXh0IHNsaWNrLW5leHRcIj48L2J1dHRvbj4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2l2ZTogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtwb2ludDogMTAyNCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1RvU2hvdzogMyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1RvU2Nyb2xsOiAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5maW5pdGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb3RzOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtwb2ludDogNjAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzVG9TaG93OiAyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzVG9TY3JvbGw6IDJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha3BvaW50OiA0ODAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNUb1Nob3c6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNUb1Njcm9sbDogMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwLmRyb3Bkb3duID0ge1xuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyICRkcm9wZG93bjtcblxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICcuai1kcm9wZG93bi10cmlnZ2VyJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgJGRyb3Bkb3duID0gJCh0aGlzKS5jbG9zZXN0KCcuai1kcm9wZG93bicpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCEkZHJvcGRvd24uaGFzQ2xhc3MoJ2lzLW9wZW4nKSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICRkcm9wZG93bi5hZGRDbGFzcygnaXMtb3BlbicpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICRkcm9wZG93bi5hZGRDbGFzcygnaXMtYW5pbWF0ZScpO1xuICAgICAgICAgICAgICAgICAgICB9LCAxMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICRkcm9wZG93bi5yZW1vdmVDbGFzcygnaXMtYW5pbWF0ZScpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICRkcm9wZG93bi5yZW1vdmVDbGFzcygnaXMtb3BlbicpO1xuICAgICAgICAgICAgICAgICAgICB9LCAyNTApOyAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpOyIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIGFwcC5mYXEgPSB7XG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJy5qLWZhcS10cmlnZ2VyJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgdmFyICRmYXEgPSAkKHRoaXMpLmNsb3Nlc3QoJy5qLWZhcScpO1xuICAgICAgICAgICAgICAgICRmYXEudG9nZ2xlQ2xhc3MoJ19vcGVuJyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwLmZpeG1lbnUgPSB7XG4gICAgICAgIFxuICAgICAgICBmaXhNZW51OiBmdW5jdGlvbigkbWVudSwgdCkge1xuXG4gICAgICAgICAgICBpZiAodCA+PSAoMTU5KSkge1xuICAgICAgICAgICAgICAgIGlmICghJG1lbnUuaGFzQ2xhc3MoJ19zdGlja2VkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgJG1lbnUuYWRkQ2xhc3MoJ19zdGlja2VkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCRtZW51Lmhhc0NsYXNzKCdfc3RpY2tlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICRtZW51LnJlbW92ZUNsYXNzKCdfc3RpY2tlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICRlbGVtZW50ID0gJCgnI25hdmlnYXRpb24nKSxcbiAgICAgICAgICAgICAgICB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdGhhdC5maXhNZW51KCRlbGVtZW50LCAkKHdpbmRvdykuc2Nyb2xsVG9wKCkpO1xuXG4gICAgICAgICAgICAkKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdGhhdC5maXhNZW51KCRlbGVtZW50LCAkKHdpbmRvdykuc2Nyb2xsVG9wKCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpOyIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIGFwcC5nYWxsZXJ5ID0ge1xuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBpZiAoJCgnLmotZ2FsbGVyeScpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICQoJy5qLWdhbGxlcnknKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykubWFnbmlmaWNQb3B1cCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaW1hZ2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZWdhdGU6ICdhLnpvb20nLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZhbERlbGF5OiA1MDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaXhlZENvbnRlbnRQb3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VPbkJnQ2xpY2s6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBnYWxsZXJ5OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdub3Njcm9sbCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ25vc2Nyb2xsJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkKCcucG9wdXAteW91dHViZSwgLnBvcHVwLXZpbWVvLCAucG9wdXAtZ21hcHMnKS5tYWduaWZpY1BvcHVwKHtcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZU9uOiA3MDAsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpZnJhbWUnLFxuICAgICAgICAgICAgICAgICAgICBtYWluQ2xhc3M6ICdtZnAtZmFkZScsXG4gICAgICAgICAgICAgICAgICAgIHJlbW92YWxEZWxheTogMTYwLFxuICAgICAgICAgICAgICAgICAgICBwcmVsb2FkZXI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBmaXhlZENvbnRlbnRQb3M6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwLm1hcCA9IHtcbiAgICAgICAgXG4gICAgICAgIF9tYXBPYmplY3Q6IG51bGwsXG5cbiAgICAgICAgX2dlb09iamVjdDogbnVsbCxcblxuICAgICAgICBnZXREYXRhOiBmdW5jdGlvbigkZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIHgsIHdyYXBfaWQgPSBudWxsLCBjb29yZHMgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoJGVsZW1lbnQuZGF0YSgnY29vcmRzJykpIHtcbiAgICAgICAgICAgICAgICBjb29yZHMgPSAkZWxlbWVudC5kYXRhKCdjb29yZHMnKS5zcGxpdCgnLCcpO1xuXG4gICAgICAgICAgICAgICAgZm9yICh4IGluIGNvb3Jkcykge1xuICAgICAgICAgICAgICAgICAgICBjb29yZHNbeF0gPSAkLnRyaW0oY29vcmRzW3hdKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoY29vcmRzLmxlbmd0aCAhPT0gMikge1xuICAgICAgICAgICAgICAgICAgICBjb29yZHMgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCRlbGVtZW50LmF0dHIoJ2lkJykpIHtcbiAgICAgICAgICAgICAgICB3cmFwX2lkID0gJGVsZW1lbnQuYXR0cignaWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpZDogd3JhcF9pZCxcbiAgICAgICAgICAgICAgICBjb29yZHM6IGNvb3Jkc1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRyb3dNYXA6IGZ1bmN0aW9uKCRlbGVtZW50KSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgZGF0YSA9IHRoaXMuZ2V0RGF0YSgkZWxlbWVudCk7XG5cbiAgICAgICAgICAgIHltYXBzLnJlYWR5KGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9tYXBPYmplY3QgPSBuZXcgeW1hcHMuTWFwKGRhdGEuaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyOiBbZGF0YS5jb29yZHNbMF0sIGRhdGEuY29vcmRzWzFdXSxcbiAgICAgICAgICAgICAgICAgICAgem9vbTogMTMsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xzOiBbJ3pvb21Db250cm9sJywgJ3NlYXJjaENvbnRyb2wnLCAndHlwZVNlbGVjdG9yJywgJ2Z1bGxzY3JlZW5Db250cm9sJ11cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIFwiZnVsbHNjcmVlbkNvbnRyb2xcIiAtINC60L3QvtC/0LrQsCDRgNCw0LfQstC+0YDQsNGH0LjQstCw0L3QuNGPINC60LDRgNGC0Ysg0L3QsCDQstC10YHRjCDRjdC60YDQsNC9IGNvbnRyb2wuRnVsbHNjcmVlbkNvbnRyb2w7XG4gICAgICAgICAgICAgICAgLy8gXCJnZW9sb2NhdGlvbkNvbnRyb2xcIiAtINC60L3QvtC/0LrQsCDQvtC/0YDQtdC00LXQu9C10L3QuNGPINC80LXRgdGC0L7Qv9C+0LvQvtC20LXQvdC40Y8g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPIGNvbnRyb2wuR2VvbG9jYXRpb25Db250cm9sO1xuICAgICAgICAgICAgICAgIC8vIFwicm91dGVFZGl0b3JcIiAtINC60L3QvtC/0LrQsCDQstC60LvRjtGH0LXQvdC40Y8g0Lgg0L7RgtC60LvRjtGH0LXQvdC40Y8g0L/QvtCy0LXQtNC10L3QuNGPIFwi0YDQtdC00LDQutGC0L7RgCDQvNCw0YDRiNGA0YPRgtCwXCIgY29udHJvbC5Sb3V0ZUVkaXRvcjtcbiAgICAgICAgICAgICAgICAvLyBcInJ1bGVyQ29udHJvbFwiIC0g0LrQvdC+0L/QutCwINCy0LrQu9GO0YfQtdC90LjRjyDQuCDQvtGC0LrQu9GO0YfQtdC90LjRjyDQv9C+0LLQtdC00LXQvdC40Y8gXCLQu9C40L3QtdC50LrQsFwiIGNvbnRyb2wuUnVsZXJDb250cm9sO1xuICAgICAgICAgICAgICAgIC8vIFwic2VhcmNoQ29udHJvbFwiIC0g0L/QsNC90LXQu9GMINC/0L7QuNGB0LrQsCBjb250cm9sLlNlYXJjaENvbnRyb2w7XG4gICAgICAgICAgICAgICAgLy8gXCJ0cmFmZmljQ29udHJvbFwiIC0g0L/QsNC90LXQu9GMINC/0YDQvtCx0L7QuiBjb250cm9sLlRyYWZmaWNDb250cm9sO1xuICAgICAgICAgICAgICAgIC8vIFwidHlwZVNlbGVjdG9yXCIgLSDQv9Cw0L3QtdC70Ywg0L/QtdGA0LXQutC70Y7Rh9C10L3QuNGPINGC0LjQv9CwINC60LDRgNGC0YsgY29udHJvbC5UeXBlU2VsZWN0b3I7XG4gICAgICAgICAgICAgICAgLy8gXCJ6b29tQ29udHJvbFwiIC0g0L/QvtC70LfRg9C90L7QuiDQvNCw0YHRiNGC0LDQsdCwIGNvbnRyb2wuWm9vbUNvbnRyb2w7XG4gICAgICAgICAgICAgICAgLy8gXCJzbWFsbE1hcERlZmF1bHRTZXRcIiAtINCx0LDQt9C+0LLRi9C5INC90LDQsdC+0YAg0Y3Qu9C10LzQtdC90YLQvtCyINGD0L/RgNCw0LLQu9C10L3QuNGPLCDQvtC/0YLQuNC80LjQt9C40YDQvtCy0LDQvdC90YvQuSDQtNC70Y8g0LrQsNGA0YIg0L3QtdCx0L7Qu9GM0YjQvtCz0L4g0YDQsNC30LzQtdGA0LAg0Lgg0Y3QutGA0LDQvdC+0LIg0YLQtdC70LXRhNC+0L3QvtCyLiDQodC+0YHRgtC+0LjRgiDQuNC3INGN0LvQtdC80LXQvdGC0L7QsiDRg9C/0YDQsNCy0LvQtdC90LjRjyBcInpvb21Db250cm9sXCIsIFwic2VhcmNoQ29udHJvbFwiLCBcInR5cGVTZWxlY3RvclwiLCBcImdlb2xvY2F0aW9uQ29udHJvbFwiINC4IFwiZnVsbHNjcmVlbkNvbnRyb2xcIi4g0JIg0Y3RgtC+0Lwg0L3QsNCx0L7RgNC1INCy0YHQtSDRjdC70LXQvNC10L3RgtGLINGD0L/RgNCw0LLQu9C10L3QuNGPINC80LjQvdC40LzQuNC30LjRgNC+0LLQsNC90Ysg0LTQviDQutC90L7Qv9C+0Log0YEg0L/QuNC60YLQvtCz0YDQsNC80LzQsNC80LguXG4gICAgICAgICAgICAgICAgLy8gXCJtZWRpdW1NYXBEZWZhdWx0U2V0XCIgLSDQvdCw0LHQvtGAINGN0LvQtdC80LXQvdGC0L7QsiDRg9C/0YDQsNCy0LvQtdC90LjRjywg0L7Qv9GC0LjQvNC40LfQuNGA0L7QstCw0L3QvdGL0Lkg0LTQu9GPINC60LDRgNGCINGB0YDQtdC00L3QtdCz0L4g0YDQsNC30LzQtdGA0LAg0Lgg0Y3QutGA0LDQvdC+0LIg0L/Qu9Cw0L3RiNC10YLQvtCyLiDQn9C+0LzQuNC80L4g0LHQsNC30L7QstC+0LPQviDQvdCw0LHQvtGA0LAg0Y3Qu9C10LzQtdC90YLQvtCyINGD0L/RgNCw0LLQu9C10L3QuNGPICjRgdC8LiDQstGL0YjQtSksINC00L7QsdCw0LLQu9GP0LXRgiDQtNC+0L/QvtC70L3QuNGC0LXQu9GM0L3QviDRjdC70LXQvNC10L3RgtGLINGD0L/RgNCw0LLQu9C10L3QuNGPIFwicnVsZXJDb250cm9sXCIg0LggXCJ0cmFmZmljQ29udHJvbFwiLlxuICAgICAgICAgICAgICAgIC8vIFwibGFyZ2VNYXBEZWZhdWx0U2V0XCIgLSDQvdCw0LHQvtGAINGN0LvQtdC80LXQvdGC0L7QsiDRg9C/0YDQsNCy0LvQtdC90LjRjywg0L7Qv9GC0LjQvNC40LfQuNGA0L7QstCw0L3QvdGL0Lkg0LTQu9GPINC60LDRgNGCINCx0L7Qu9GM0YjQvtCz0L4g0YDQsNC30LzQtdGA0LAg0Lgg0Y3QutGA0LDQvdC+0LIg0LTQtdGB0LrRgtC+0L/QvdGL0YUg0LrQvtC80L/RjNGO0YLQtdGA0L7Qsi4g0J7RgtC70LjRh9Cw0LXRgtGB0Y8g0L7RgiDQvdCw0LHQvtGA0LAgXCJtZWRpdW1NYXBEZWZhdWx0U2V0XCIg0L3QsNC70LjRh9C40LXQvCDRjdC70LXQvNC10L3RgtCwINGD0L/RgNCw0LLQu9C10L3QuNGPIFwicm91dGVFZGl0b3JcIiDQuCDQvtGC0YHRg9GC0YHRgtCy0LjQtdC8INGN0LvQtdC80LXQvdGC0LAg0YPQv9GA0LDQstC70LXQvdC40Y8gXCJmdWxsU2NyZWVuXCI7XG4gICAgICAgICAgICAgICAgLy8gXCJkZWZhdWx0XCIgLSDQvdCw0LHQvtGAINGN0LvQtdC80LXQvdGC0L7QsiDRg9C/0YDQsNCy0LvQtdC90LjRjyDQv9C+INGD0LzQvtC70YfQsNC90LjRjjsg0YHQuNC90L7QvdC40Lwg0LTQu9GPINC90LDQsdC+0YDQsCBcIm1lZGl1bU1hcERlZmF1bHRTZXRcIi5cblxuICAgICAgICAgICAgICAgIHRoYXQuX21hcE9iamVjdC5iZWhhdmlvcnMuZGlzYWJsZSgnc2Nyb2xsWm9vbScpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5fbWFwT2JqZWN0LmNvbnRyb2xzLmdldCgnem9vbUNvbnRyb2wnKS5vcHRpb25zLnNldCgnc2l6ZScsICdzbWFsbCcpO1xuICAgICAgICAgICAgICAgIHRoYXQuX21hcE9iamVjdC5jb250cm9scy5nZXQoJ3pvb21Db250cm9sJykub3B0aW9ucy5zZXQoJ3Bvc2l0aW9uJywgeyByaWdodDogMTAsIHRvcDogNTAgfSk7XG5cbiAgICAgICAgICAgICAgICB0aGF0Ll9tYXBPYmplY3QuZ2VvT2JqZWN0c1xuICAgICAgICAgICAgICAgICAgICAuYWRkKG5ldyB5bWFwcy5QbGFjZW1hcmsoW2RhdGEuY29vcmRzWzBdLCBkYXRhLmNvb3Jkc1sxXV0sIHt9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmVzZXQ6ICdpc2xhbmRzI2RvdEljb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkNvbG9yOiAnIzczNTE4NCdcbiAgICAgICAgICAgICAgICAgICAgfSkpXG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmICgkKCcuai1tYXAnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkKCcuai1tYXAnKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZHJvd01hcCgkKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwLm1vcnBoID0ge1xuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZnVuY3Rpb24gbW9ycGhEcm9wZG93biggZWxlbWVudCApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICAgICAgICAgIHRoaXMubWFpbk5hdmlnYXRpb24gPSB0aGlzLmVsZW1lbnQuZmluZCgnLm1haW4tbmF2Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5tYWluTmF2aWdhdGlvbkl0ZW1zID0gdGhpcy5tYWluTmF2aWdhdGlvbi5maW5kKCcuaGFzLWRyb3Bkb3duJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bkxpc3QgPSB0aGlzLmVsZW1lbnQuZmluZCgnLmRyb3Bkb3duLWxpc3QnKTtcbiAgICAgICAgICAgICAgICAvLy4uLlxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRoaXMuYmluZEV2ZW50cygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBtb3JwaERyb3Bkb3duLnByb3RvdHlwZS5iaW5kRXZlbnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRoaXMubWFpbk5hdmlnYXRpb25JdGVtcy5tb3VzZWVudGVyKGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgICAgICAgICAgICAgLy9ob3ZlciBvdmVyIG9uZSBvZiB0aGUgbmF2IGl0ZW1zIC0+IHNob3cgZHJvcGRvd25cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93RHJvcGRvd24oJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgfSkubW91c2VsZWF2ZShmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAvL2lmIG5vdCBob3ZlcmluZyBvdmVyIGEgbmF2IGl0ZW0gb3IgYSBkcm9wZG93biAtPiBoaWRlIGRyb3Bkb3duXG4gICAgICAgICAgICAgICAgICAgIGlmKCBzZWxmLm1haW5OYXZpZ2F0aW9uLmZpbmQoJy5oYXMtZHJvcGRvd246aG92ZXInKS5sZW5ndGggPT0gMCAmJiBzZWxmLmVsZW1lbnQuZmluZCgnLmRyb3Bkb3duLWxpc3Q6aG92ZXInKS5sZW5ndGggPT0gMCApIHNlbGYuaGlkZURyb3Bkb3duKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBtb3JwaERyb3Bkb3duLnByb3RvdHlwZS5zaG93RHJvcGRvd24gPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkRHJvcGRvd24gPSB0aGlzLmRyb3Bkb3duTGlzdC5maW5kKCcjJytpdGVtLmRhdGEoJ2NvbnRlbnQnKSksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRHJvcGRvd25IZWlnaHQgPSBzZWxlY3RlZERyb3Bkb3duLmlubmVySGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRHJvcGRvd25XaWR0aCA9IHNlbGVjdGVkRHJvcGRvd24uY2hpbGRyZW4oJy5jb250ZW50JykuaW5uZXJXaWR0aCgpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZERyb3Bkb3duTGVmdCA9IGl0ZW0ub2Zmc2V0KCkubGVmdCArIGl0ZW0uaW5uZXJXaWR0aCgpLzIgLSBzZWxlY3RlZERyb3Bkb3duV2lkdGgvMjtcbiAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvL3VwZGF0ZSBkcm9wZG93biBhbmQgZHJvcGRvd24gYmFja2dyb3VuZCBwb3NpdGlvbiBhbmQgc2l6ZVxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRHJvcGRvd24oc2VsZWN0ZWREcm9wZG93biwgcGFyc2VJbnQoc2VsZWN0ZWREcm9wZG93bkhlaWdodCksIHNlbGVjdGVkRHJvcGRvd25XaWR0aCwgcGFyc2VJbnQoc2VsZWN0ZWREcm9wZG93bkxlZnQpKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvL2FkZCB0aGUgLmFjdGl2ZSBjbGFzcyB0byB0aGUgc2VsZWN0ZWQgLmRyb3Bkb3duIGFuZCAuaXMtZHJvcGRvd24tdmlzaWJsZSB0byB0aGUgLmNkLW1vcnBoLWRyb3Bkb3duIFxuICAgICAgICAgICAgICAgIC8vLi4uXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgIFxuICAgICAgICAgICAgbW9ycGhEcm9wZG93bi5wcm90b3R5cGUudXBkYXRlRHJvcGRvd24gPSBmdW5jdGlvbihkcm9wZG93bkl0ZW0sIGhlaWdodCwgd2lkdGgsIGxlZnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duTGlzdC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAnLW1vei10cmFuc2Zvcm0nOiAndHJhbnNsYXRlWCgnICsgbGVmdCArICdweCknLFxuICAgICAgICAgICAgICAgICAgICAnLXdlYmtpdC10cmFuc2Zvcm0nOiAndHJhbnNsYXRlWCgnICsgbGVmdCArICdweCknLFxuICAgICAgICAgICAgICAgICAgICAnLW1zLXRyYW5zZm9ybSc6ICd0cmFuc2xhdGVYKCcgKyBsZWZ0ICsgJ3B4KScsXG4gICAgICAgICAgICAgICAgICAgICctby10cmFuc2Zvcm0nOiAndHJhbnNsYXRlWCgnICsgbGVmdCArICdweCknLFxuICAgICAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZVgoJyArIGxlZnQgKyAncHgpJyxcbiAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJzogd2lkdGgrJ3B4JyxcbiAgICAgICAgICAgICAgICAgICAgJ2hlaWdodCc6IGhlaWdodCsncHgnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bkJnLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICctbW96LXRyYW5zZm9ybSc6ICdzY2FsZVgoJyArIHdpZHRoICsgJykgc2NhbGVZKCcgKyBoZWlnaHQgKyAnKScsXG4gICAgICAgICAgICAgICAgICAgICctd2Via2l0LXRyYW5zZm9ybSc6ICdzY2FsZVgoJyArIHdpZHRoICsgJykgc2NhbGVZKCcgKyBoZWlnaHQgKyAnKScsXG4gICAgICAgICAgICAgICAgICAgICctbXMtdHJhbnNmb3JtJzogJ3NjYWxlWCgnICsgd2lkdGggKyAnKSBzY2FsZVkoJyArIGhlaWdodCArICcpJyxcbiAgICAgICAgICAgICAgICAgICAgJy1vLXRyYW5zZm9ybSc6ICdzY2FsZVgoJyArIHdpZHRoICsgJykgc2NhbGVZKCcgKyBoZWlnaHQgKyAnKScsXG4gICAgICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAnc2NhbGVYKCcgKyB3aWR0aCArICcpIHNjYWxlWSgnICsgaGVpZ2h0ICsgJyknXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpOyIsIihmdW5jdGlvbigkKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICB2YXIgdGhhdCwgdG9wLCBjaGFuZ2VJdGVtLCBzY3JvbGxUb0FuY2hvciwgJHRhcmdldCwgJGVsZW1lbnQsICRjdXJyZW50LCAkbmF2aWdhdGlvbk1hcCwgJG5hdmlnYXRpb24gPSAkKCcjbmF2aWdhdGlvbicpLCAkaGFzU2Nyb2xsID0gJCgnaHRtbCwgYm9keScpO1xuICAgIHZhciBpc19tb2JpbGUgPSAkKHdpbmRvdykud2lkdGgoKSA8PSA2Njc7XG5cbiAgICAkbmF2aWdhdGlvbk1hcCA9ICQoJy5qLXNlY3Rpb24nKS5tYXAoZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG9mZnNldDogJCh0aGlzKS5vZmZzZXQoKS50b3AsXG4gICAgICAgICAgICBlbGVtZW50OiAkKHRoaXMpXG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGNoYW5nZUl0ZW0gPSBmdW5jdGlvbihzY3JvbGxUb3ApIHtcbiAgICAgICAgJGVsZW1lbnQgPSBudWxsO1xuXG4gICAgICAgICRuYXZpZ2F0aW9uTWFwLm1hcChmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhhdCA9ICQodGhpcylbMF07XG4gICAgICAgICAgICBpZiAodGhhdC5vZmZzZXQgPCBzY3JvbGxUb3ApIHtcbiAgICAgICAgICAgICAgICAkZWxlbWVudCA9IHRoYXQuZWxlbWVudDsgXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgaWYgKCRlbGVtZW50ICE9PSBudWxsICYmICRlbGVtZW50LmRhdGEoJ3NjcmVlbicpKSB7XG4gICAgICAgICAgICAkY3VycmVudCA9ICRuYXZpZ2F0aW9uLmZpbmQoJy5qLW5hdmlnYXRpb25baHJlZj1cIiMnICsgJGVsZW1lbnQuZGF0YSgnc2NyZWVuJykgKyAnXCJdJyk7XG5cbiAgICAgICAgICAgIGlmICghJGN1cnJlbnQuaGFzQ2xhc3MoJ19jdXJyZW50JykpIHtcbiAgICAgICAgICAgICAgICAkbmF2aWdhdGlvbi5maW5kKCcuai1uYXZpZ2F0aW9uLl9jdXJyZW50JykucmVtb3ZlQ2xhc3MoJ19jdXJyZW50Jyk7XG4gICAgICAgICAgICAgICAgJGN1cnJlbnQuYWRkQ2xhc3MoJ19jdXJyZW50Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzY3JvbGxUb0FuY2hvciA9IGZ1bmN0aW9uKGhhc2gsIGFuaW1hdGUpIHtcbiAgICAgICAgJHRhcmdldCA9ICQoaGFzaCArICctYW5jaG9yJyk7XG5cbiAgICAgICAgaWYgKCR0YXJnZXQubGVuZ3RoKVxuICAgICAgICB7XG4gICAgICAgICAgICBpc19tb2JpbGUgPSAkKHdpbmRvdykud2lkdGgoKSA8PSA2Njc7XG4gICAgICAgICAgICB0b3AgPSAkdGFyZ2V0Lm9mZnNldCgpLnRvcDtcblxuICAgICAgICAgICAgaWYgKGlzX21vYmlsZSkge1xuICAgICAgICAgICAgICAgIHRvcCA9IHRvcCAtIDEwMFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYW5pbWF0ZSkge1xuICAgICAgICAgICAgICAgICRoYXNTY3JvbGwuc3RvcCgpLmFuaW1hdGUoeyAnc2Nyb2xsVG9wJzogdG9wIH0sICdtZWRpdW0nLCAnZWFzZUluT3V0Q2lyYycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJGhhc1Njcm9sbC5zY3JvbGxUb3AodG9wKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgICQoJy5qLW5hdmlnYXRpb24nKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHNjcm9sbFRvQW5jaG9yKHRoaXMuaGFzaCwgdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaGFzaC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBzY3JvbGxUb0FuY2hvcih3aW5kb3cubG9jYXRpb24uaGFzaCwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSwgMTUwKTtcblxuICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgY2hhbmdlSXRlbSgkKHdpbmRvdykuc2Nyb2xsVG9wKCkpXG4gICAgfSk7XG59KShqUXVlcnkpOyIsInZhciBhcHAgPSBhcHAgfHwge307XG5cbihmdW5jdGlvbihib2R5KXtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIGFwcC5wYWdldXAgPSB7XG5cbiAgICAgICAgZWxlbWVudDogbnVsbCxcblxuICAgICAgICBjbGljazogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5zdG9wKCkuYW5pbWF0ZSh7IHNjcm9sbFRvcDogMCB9LCBcImZhc3RcIik7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGVjazogZnVuY3Rpb24oc2N0b3ApXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmIChzY3RvcCA+IDE1MClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZiAoIV90aGlzLmVsZW1lbnQuaGFzQ2xhc3MoJ2lzLXNob3cnKSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmVsZW1lbnQuYWRkQ2xhc3MoJ2lzLXNob3cnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIV90aGlzLmVsZW1lbnQuaGFzQ2xhc3MoJ2lzLWFuaW1hdGUnKSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmVsZW1lbnQuYWRkQ2xhc3MoJ2lzLWFuaW1hdGUnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMTApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCdpcy1hbmltYXRlJyk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2lzLXNob3cnKTtcbiAgICAgICAgICAgICAgICB9LCAxNTApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgX3RoaXMuZWxlbWVudCA9ICQoJy5qLXBhZ2UtdXAnKTtcblxuICAgICAgICAgICAgX3RoaXMuY2hlY2soJCh3aW5kb3cpLnNjcm9sbFRvcCgpKTtcblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIF90aGlzLmNoZWNrKCQod2luZG93KS5zY3JvbGxUb3AoKSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgX3RoaXMuY2xpY2soKTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwLnByZWxvYWQgPSB7XG5cbiAgICAgICAgcHJlbG9hZDogZnVuY3Rpb24oJGltYWdlKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgdXJsID0gJGltYWdlLmRhdGEoJ3ByZWxvYWQnKSwgaW1hZ2UgPSBudWxsO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICAgICAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICRpbWFnZS5hdHRyKCdzcmMnLCB1cmwpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaW1hZ2Uuc3JjID0gdXJsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAkaW1hZ2UuYXR0cignc3JjJywgdXJsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJGltYWdlLnJlbW92ZUF0dHIoJ3dpZHRoIGhlaWdodCcpO1xuICAgICAgICAgICAgJGltYWdlLmRhdGEoJ3ByZWxvYWQnLCAnJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAoJCgnaW1nW2RhdGEtcHJlbG9hZF0nKS5sZW5ndGgpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICQoJ2ltZ1tkYXRhLXByZWxvYWRdJykuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24oJGltYWdlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnByZWxvYWQoJGltYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfSkoJCh0aGlzKSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwLnF1YW50aXR5ID0ge1xuXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgZWxlbWVudDogJy5qLXF1YW50aXR5JyxcbiAgICAgICAgICAgIGlucHV0OiAnLmotcXVhbnRpdHktY291bnQnLFxuICAgICAgICAgICAgY29udHJvbDogJy5qLXF1YW50aXR5LWNvbnRyb2wnLFxuICAgICAgICAgICAgY29tcGxldGU6IG51bGxcbiAgICAgICAgfSxcblxuICAgICAgICBlbGVtZW50OiBudWxsLFxuXG4gICAgICAgIGV4dGVuZDogZnVuY3Rpb24oY29uZmlnKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIHg7XG4gICAgICAgICAgICAgICAgZm9yICh4IGluIGNvbmZpZylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgX3RoaXMuY29uZmlnW3hdICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbmZpZ1t4XSA9IGNvbmZpZ1t4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uKHF1YW50aXR5KVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgbWluID0gMSwgbWF4ID0gMTAwO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5lbGVtZW50LmRhdGEoJ21pbicpKSB7XG4gICAgICAgICAgICAgICAgbWluID0gdGhpcy5lbGVtZW50LmRhdGEoJ21pbicpOyAgIFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAodGhpcy5lbGVtZW50LmRhdGEoJ21heCcpKSB7XG4gICAgICAgICAgICAgICAgbWF4ID0gdGhpcy5lbGVtZW50LmRhdGEoJ21heCcpOyAgIFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocXVhbnRpdHkgPiBtYXgpIHtcbiAgICAgICAgICAgICAgICBxdWFudGl0eSA9IG1heDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKHF1YW50aXR5IDwgbWluKSB7XG4gICAgICAgICAgICAgICAgcXVhbnRpdHkgPSBtaW47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5maW5kKHRoaXMuY29uZmlnLmlucHV0KS52YWwocXVhbnRpdHkpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5jcmVhc2U6IGZ1bmN0aW9uKHF1YW50aXR5KVxuICAgICAgICB7XG4gICAgICAgICAgICBxdWFudGl0eSArPSAxO1xuXG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlKHF1YW50aXR5KTtcbiAgICAgICAgfSxcblxuICAgICAgICBkZWNyZWFzZTogZnVuY3Rpb24ocXVhbnRpdHkpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmIChxdWFudGl0eSA+IDEpIHtcbiAgICAgICAgICAgICAgICBxdWFudGl0eSAtPSAxO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlKHF1YW50aXR5KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAodHlwZW9mKHRoaXMuZWxlbWVudC5kYXRhKCdwcm9kdWN0JykpICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YodGhpcy5jb25maWcuY29tcGxldGUpID09ICdmdW5jdGlvbicpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcuY29tcGxldGUuY2FsbChudWxsLCB0aGlzLmVsZW1lbnQsIHRoaXMuZWxlbWVudC5kYXRhKCdwcm9kdWN0JykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGtleXM6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcywgcm9sZSA9ICcnO1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2tleWRvd24nLCBfdGhpcy5jb25maWcuaW5wdXQsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoWzM4LCA0MF0uaW5kZXhPZihlLmtleUNvZGUpID49IDApXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgcm9sZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIDM4OiAnaW5jcmVhc2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgNDA6ICdkZWNyZWFzZSdcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5lbGVtZW50ID0gJCh0aGlzKS5jbG9zZXN0KF90aGlzLmNvbmZpZy5lbGVtZW50KTtcblxuICAgICAgICAgICAgICAgICAgICBfdGhpc1tyb2xlW2Uua2V5Q29kZV1dKHBhcnNlSW50KF90aGlzLmVsZW1lbnQuZmluZChfdGhpcy5jb25maWcuaW5wdXQpLnZhbCgpKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2FsbGJhY2soKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmluZDogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzLCByb2xlID0gJyc7XG5cbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCBfdGhpcy5jb25maWcuY29udHJvbCwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIF90aGlzLmVsZW1lbnQgPSAkKHRoaXMpLmNsb3Nlc3QoX3RoaXMuY29uZmlnLmVsZW1lbnQpO1xuXG4gICAgICAgICAgICAgICAgcm9sZSA9ICQodGhpcykuZGF0YSgncm9sZScpO1xuICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYoWydpbmNyZWFzZScsICdkZWNyZWFzZSddLmluZGV4T2Yocm9sZSkgPj0gMClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzW3JvbGVdKHBhcnNlSW50KF90aGlzLmVsZW1lbnQuZmluZChfdGhpcy5jb25maWcuaW5wdXQpLnZhbCgpKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX3RoaXMuY2FsbGJhY2soKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKGNvbmZpZylcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRoaXMuZXh0ZW5kKGNvbmZpZyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuYmluZCgpO1xuICAgICAgICAgICAgdGhpcy5rZXlzKCk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKGRvY3VtZW50LmJvZHkpO1xuXG4vLyB0aGlzLnF1YW50aXR5LmluaXQoe1xuLy8gICAgIGNvbXBsZXRlOiBmdW5jdGlvbihlbGVtZW50LCBpZCkge1xuLy8gICAgICAgICAvLyAkKGVsZW1lbnQpLmNzcyh7XG4vLyAgICAgICAgIC8vICAgICAnYm9yZGVyJzogJzFweCBzb2xpZCBsaW1lJ1xuLy8gICAgICAgICAvLyB9KTtcblxuLy8gICAgICAgICBjb25zb2xlLmxvZyhcImlkIDpcIiwgaWQpO1xuLy8gICAgIH1cbi8vIH0pO1xuXG4vLyA8ZGl2IGNsYXNzPVwicXVhbnRpdHkgai1xdWFudGl0eSBjbGVhcmZpeFwiIGRhdGEtcHJvZHVjdD1cIjEwMDBcIiBkYXRhLW1pbj1cIjFcIiBkYXRhLW1heD1cIjk5OVwiPlxuLy8gICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwicXVhbnRpdHlfX2NvbnRyb2wgX2RlY3JlYXNlIGotcXVhbnRpdHktY29udHJvbFwiIGRhdGEtcm9sZT1cImRlY3JlYXNlXCI+PC9idXR0b24+XG4vLyAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgbmFtZT1cImNvdW50WzEwMDBdXCIgdmFsdWU9XCIxXCIgZGF0YS1yb2xlPVwicXVhbnRpdHktaW5wdXRcIiBjbGFzcz1cInF1YW50aXR5X19jb3VudCBqLXF1YW50aXR5LWNvdW50XCIgbWF4bGVuZ3RoPVwiM1wiIGF1dG9jb21wbGV0ZT1cIm9mZlwiPlxuLy8gICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwicXVhbnRpdHlfX2NvbnRyb2wgX2luY3JlYXNlIGotcXVhbnRpdHktY29udHJvbFwiIGRhdGEtcm9sZT1cImluY3JlYXNlXCI+PC9idXR0b24+XG4vLyA8L2Rpdj4iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG47KGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIF90aGlzO1xuXG4gICAgYXBwLnNhbmR3aWNoID0ge1xuXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAga2V5SG9va3M6ICExLFxuICAgICAgICAgICAgc2VsZWN0b3I6ICcuanMtc2FuZHdpY2gtbWVudScsXG4gICAgICAgICAgICB3cmFwcGVyOiAnLmxheW91dC13cmFwcGVyJyxcbiAgICAgICAgICAgIG92ZXJsYXk6ICcub3ZlcmxheSdcbiAgICAgICAgfSxcblxuICAgICAgICBleHRlbmQ6IGZ1bmN0aW9uKGNvbmZpZylcbiAgICAgICAge1xuICAgICAgICAgICAgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIHg7XG4gICAgICAgICAgICAgICAgZm9yICh4IGluIGNvbmZpZylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgX3RoaXMuY29uZmlnW3hdICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbmZpZ1t4XSA9IGNvbmZpZ1t4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNPcGVuOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybiAkKCdib2R5JykuaGFzQ2xhc3MoJ3BhZ2UtdmlzaWJsZScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhpZGU6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdwYWdlLW9wZW4nKTtcblxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygncGFnZS12aXNpYmxlJyk7XG4gICAgICAgICAgICB9LCAxMCk7XG5cbiAgICAgICAgICAgICQodGhpcy5jb25maWcub3ZlcmxheSkuY3NzKHtcbiAgICAgICAgICAgICAgICAndmlzaWJpbGl0eSc6ICdoaWRkZW4nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygncGFnZS12aXNpYmxlJykpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdwYWdlLW9wZW4nKTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdwYWdlLXZpc2libGUnKTtcbiAgICAgICAgICAgICAgICB9LCAyMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygncGFnZS1vcGVuJyk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygncGFnZS12aXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgfSwgMTApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcblxuICAgICAgICAgICAgaWYgKCEkKCdib2R5JykuaGFzQ2xhc3MoJ3BhZ2Utb3BlbicpKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZpc2liaWxpdHkgPSAnaGlkZGVuJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAkKF90aGlzLmNvbmZpZy5vdmVybGF5KS5jc3Moe1xuICAgICAgICAgICAgICAgICd2aXNpYmlsaXR5JzogdmlzaWJpbGl0eVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2FuZHdpY2hUcmlnZ2VyOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKF90aGlzLmNvbmZpZy5rZXlIb29rcylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkKCdib2R5Jykub24oJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGUua2V5Q29kZSA9PSAyNyAmJiBfdGhpcy5pc09wZW4oKSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCBfdGhpcy5jb25maWcuc2VsZWN0b3IsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQgPyBlLnByZXZlbnREZWZhdWx0KCkgOiBlLnJldHVyblZhbHVlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgX3RoaXMudG9nZ2xlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBvdmVybGF5VHJpZ2dlcjogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCBfdGhpcy5jb25maWcub3ZlcmxheSwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgX3RoaXMuaGlkZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oY29uZmlnKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLmV4dGVuZChjb25maWcpO1xuICAgICAgICAgICAgdGhpcy5zYW5kd2ljaFRyaWdnZXIoKTtcbiAgICAgICAgICAgIHRoaXMub3ZlcmxheVRyaWdnZXIoKTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwLnNob3BwaW5nQ2FydCA9IHtcblxuICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgIGFkZDogJy5qLWNhcnQtYWRkJyxcbiAgICAgICAgICAgIHJlbW92ZTogJy5qLWNhcnQtcmVtb3ZlJyxcbiAgICAgICAgICAgIGNvdW50OiAnLndhdGNoLWNhcnQtY291bnQnLFxuICAgICAgICAgICAgYW1vdW50OiAnLndhdGNoLWNhcnQtYW1vdW50JyxcbiAgICAgICAgICAgIGRpc2NvdW50OiAnLndhdGNoLWNhcnQtZGlzY291bnQnLFxuICAgICAgICAgICAgY29udGFpbmVyOiAnLmotYnV0dG9uLWNvbnRhaW5lcicsXG4gICAgICAgICAgICB0b2dnbGVfY2xhc3M6ICdpbi1jYXJ0JyxcbiAgICAgICAgICAgIHByb2R1Y3Q6IGZ1bmN0aW9uKCRpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KCRpdGVtLmRhdGEoJ3Byb2R1Y3QnKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGltZW91dDogNTAsXG4gICAgICAgICAgICBjYWxsYmFjazogbnVsbFxuICAgICAgICB9LFxuXG4gICAgICAgIGV4dGVuZDogZnVuY3Rpb24oY29uZmlnKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIHg7XG4gICAgICAgICAgICAgICAgZm9yICh4IGluIGNvbmZpZylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgX3RoaXMuY29uZmlnW3hdICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbmZpZ1t4XSA9IGNvbmZpZ1t4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKCRpdGVtLCByZXNwb25zZSlcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKHR5cGVvZih0aGlzLmNvbmZpZy5jYWxsYmFjaykgPT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5jYWxsYmFjay5jYWxsKHRoaXMsICRpdGVtLCByZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXNwb25zZS5jb3VudCAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMuY29uZmlnLmNvdW50KS5odG1sKHJlc3BvbnNlLmNvdW50KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuY291bnQgPiAwKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkaXRlbS5jbG9zZXN0KHRoaXMuY29uZmlnLmNvbnRhaW5lcikuYWRkQ2xhc3ModGhpcy5jb25maWcudG9nZ2xlX2NsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtLmNsb3Nlc3QodGhpcy5jb25maWcuY29udGFpbmVyKS5yZW1vdmVDbGFzcyh0aGlzLmNvbmZpZy50b2dnbGVfY2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICRpdGVtLmNsb3Nlc3QodGhpcy5jb25maWcuY29udGFpbmVyKS5yZW1vdmVDbGFzcyh0aGlzLmNvbmZpZy50b2dnbGVfY2xhc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3BvbnNlLmFtb3VudCAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgeyAgIFxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMuY29uZmlnLmFtb3VudCkuaHRtbCh0aGlzLmNvbnZlcnRNb25leShyZXNwb25zZS5hbW91bnQpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3BvbnNlLnJlbW92ZSAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAkaXRlbS5jbG9zZXN0KHRoaXMuY29uZmlnLmNvbnRhaW5lcikucmVtb3ZlQ2xhc3ModGhpcy5jb25maWcudG9nZ2xlX2NsYXNzKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICRpdGVtLmRhdGEoJ2Jsb2NrZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcy5jb25maWcudGltZW91dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29udmVydE1vbmV5OiBmdW5jdGlvbihuKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgYyA9IDAsXG4gICAgICAgICAgICAgICAgZCA9ICcnLFxuICAgICAgICAgICAgICAgIHQgPSAnICcsXG4gICAgICAgICAgICAgICAgcyA9IG4gPCAwID8gXCItXCIgOiBcIlwiLFxuICAgICAgICAgICAgICAgIGkgPSBwYXJzZUludChuID0gTWF0aC5hYnMoK24gfHwgMCkudG9GaXhlZChjKSkgKyBcIlwiLFxuICAgICAgICAgICAgICAgIGogPSAoaiA9IGkubGVuZ3RoKSA+IDMgPyBqICUgMyA6IDA7XG5cbiAgICAgICAgICAgIHJldHVybiBzICsgKGogPyBpLnN1YnN0cigwLCBqKSArIHQgOiBcIlwiKSArIGkuc3Vic3RyKGopLnJlcGxhY2UoLyhcXGR7M30pKD89XFxkKS9nLCBcIiQxXCIgKyB0KSArIChjID8gZCArIE1hdGguYWJzKG4gLSBpKS50b0ZpeGVkKGMpLnNsaWNlKDIpIDogXCJcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmluZDogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgW190aGlzLmNvbmZpZy5yZW1vdmUsIF90aGlzLmNvbmZpZy5hZGRdLmpvaW4oJywnKSwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCEkKHRoaXMpLmRhdGEoJ2Jsb2NrZWQnKSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnJlcXVlc3QoJCh0aGlzKSk7ICAgXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24oJGl0ZW0pXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICRpdGVtLmRhdGEoJ2Jsb2NrZWQnLCB0cnVlKTtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcbiAgICAgICAgICAgIHZhciBhY3Rpb24gPSAnJztcbiAgICAgICAgICAgIHZhciBtZXRob2QgPSAnR0VUJztcblxuICAgICAgICAgICAgaWYgKCRpdGVtLmRhdGEoJ21ldGhvZCcpKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG1ldGhvZCA9ICRpdGVtLmRhdGEoJ21ldGhvZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoJGl0ZW0uZGF0YSgnYWN0aW9uJykpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYWN0aW9uID0gJGl0ZW0uZGF0YSgnYWN0aW9uJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghYWN0aW9uICYmICRpdGVtLmF0dHIoJ2hyZWYnKSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBhY3Rpb24gPSAkaXRlbS5hdHRyKCdocmVmJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICgkaXRlbS5kYXRhKCdwcm9kdWN0JykpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZGF0YVsncHJvZHVjdCddID0gdGhpcy5jb25maWcucHJvZHVjdCgkaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiBhY3Rpb24sXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICB0eXBlOiBtZXRob2QsXG4gICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnSlNPTicsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jYWxsYmFjaygkaXRlbSwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHJlc3BvbnNlKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgJGl0ZW0uZGF0YSgnYmxvY2tlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yOiAnLCByZXNwb25zZSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbihjb25maWcpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZmlnICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLmV4dGVuZChjb25maWcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmJpbmQoKTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7XG5cbi8vIHRoaXMuc2hvcHBpbmdDYXJ0LmluaXQoe1xuLy8gICAgIGFkZDogJy5qLXNob3BwaW5nLWNhcnQtYWRkJyxcbi8vICAgICByZW1vdmU6ICcuai1zaG9wcGluZy1jYXJ0LXJlbW92ZSdcbi8vIH0pO1xuXG4vLyA8YSBocmVmPVwiL2NhcnQvcmVtb3ZlP3Byb2R1Y3Q9MTAmYmFja3VyaT14eFwiIGRhdGEtYWN0aW9uPVwiL2NhcnQvcmVtb3ZlXCIgZGF0YS1wcm9kdWN0PVwieyRwcm9kdWN0LmlkfVwiIGRhdGEtbWV0aG9kPVwiUE9TVHxHRVRcIiBjbGFzcz1cImJ1dHRvbiByZW1vdmUgai1jYXJ0LXJlbW92ZVwiIHRpdGxlPVwi0KPQtNCw0LvQuNGC0Ywg0LjQtyDQutC+0YDQt9C40L3Ri1wiPtCj0LTQsNC70LjRgtGMINC40Lcg0LrQvtGA0LfQuNC90Ys8L2E+XG4vLyA8YSBocmVmPVwiL2NhcnQvYWRkP3Byb2R1Y3Q9MTAmYmFja3VyaT14eFwiIGRhdGEtYWN0aW9uPVwiL2NhcnQvcmVtb3ZlXCIgZGF0YS1wcm9kdWN0PVwieyRwcm9kdWN0LmlkfVwiIGRhdGEtbWV0aG9kPVwiUE9TVHxHRVRcIiBjbGFzcz1cImJ1dHRvbiBhZGQgai1jYXJ0LWFkZFwiIHRpdGxlPVwi0JTQvtCx0LDQstC40YLRjCDQsiDQutC+0YDQt9C40L3Rg1wiPtCU0L7QsdCw0LLQuNGC0Ywg0LIg0LrQvtGA0LfQuNC90YM8L2E+XG4iLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oYm9keSl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICBhcHAuc2xpZGVyID0ge1xuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCQoJy5qLXNsaWRlcicpLmxlbmd0aCAmJiAkKCcuai1zbGlkZXInKS5maW5kKCcuc2xpY2stc2xpZGUnKS5sZW5ndGgpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gMSwgY2xhc3NuYW1lID0gJ3NsaWRlcicsIHByZWZpeCA9ICdzbGlkZXInLCAkc2xpZGVyID0gJycsIHdpZHRoID0gJCh3aW5kb3cpLndpZHRoKCksIG9wdGlvbnMgPSB7fTtcblxuICAgICAgICAgICAgICAgICQoJy5qLXNsaWRlcicpLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSAxO1xuICAgICAgICAgICAgICAgICAgICBjbGFzc25hbWUgPSAnc2xpZGVyJztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKCdwcmVmaXgnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJlZml4ID0gJCh0aGlzKS5kYXRhKCdwcmVmaXgnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmYWRlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG90czogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWVkOiA1MDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZpbml0ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9wbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRvcGxheVNwZWVkOiA2NTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGF1c2VPbkhvdmVyOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZVRyYW5zZm9ybTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZVdpZHRoOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzc0Vhc2U6ICdsaW5lYXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2l2ZTogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtwb2ludDogOTUwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG90czogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlciA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzbGlkZXIuZGF0YSgndmlld2NvdW50JykpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ID0gcGFyc2VJbnQoJHNsaWRlci5kYXRhKCd2aWV3Y291bnQnKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLm9uKCdiZWZvcmVDaGFuZ2UnLCBmdW5jdGlvbihldmVudCwgc2xpY2ssIGN1cnJlbnRTbGlkZSwgbmV4dFNsaWRlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGN1cnJlbnRTbGlkZSwgbmV4dFNsaWRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjdXJyZW50ID0gJChzbGljay4kc2xpZGVzW2N1cnJlbnRTbGlkZV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRuZXh0ID0gJChzbGljay4kc2xpZGVzW25leHRTbGlkZV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gJG5leHQuZmluZCgnLmotYWZ0ZXItc2xpZGUnKS5yZW1vdmVDbGFzcygnaXMtc2hvdyBpcy1hbmltYXRlJyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIub24oJ2FmdGVyQ2hhbmdlJywgZnVuY3Rpb24oZXZlbnQsIHNsaWNrLCBjdXJyZW50U2xpZGUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjdXJyZW50ID0gJChzbGljay4kc2xpZGVzW2N1cnJlbnRTbGlkZV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnQuZmluZCgnLmotYWZ0ZXItc2xpZGUnKS5hZGRDbGFzcygnaXMtc2hvdycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnQuZmluZCgnLmotYWZ0ZXItc2xpZGUnKS5hZGRDbGFzcygnaXMtYW5pbWF0ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTApO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNsaWRlci5oYXNDbGFzcygnai1zbGlkZXItY2FsYycpKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmZpbmQoJy5zbGljay1zbGlkZScpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJzogd2lkdGggKyAncHgnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2xpZGVyLmRhdGEoJ2NsYXNzbmFtZScpKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc25hbWUgPSAkc2xpZGVyLmRhdGEoJ2NsYXNzbmFtZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAoISRzbGlkZXIuaGFzQ2xhc3MoJ2otZGlzYWJsZS1uYXZpZ2F0aW9uJykpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbJ3ByZXZBcnJvdyddID0gJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiJyArIHByZWZpeCArICdfX25hdiBfcHJldiBzbGljay1wcmV2XCI+PC9idXR0b24+JztcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbJ25leHRBcnJvdyddID0gJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiJyArIHByZWZpeCArICdfX25hdiBfbmV4dCBzbGljay1uZXh0XCI+PC9idXR0b24+JztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbJ2Fycm93cyddID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLnNsaWNrKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9O1xuXG59KShkb2N1bWVudC5ib2R5KTsiLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xuXG4oZnVuY3Rpb24oYm9keSl7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICBhcHAudGFicyA9IHtcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciAkd3JhcHBlciA9IG51bGwsIHRhYiA9ICcnO1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJy5qLXRhYi10cmlnZ2VyJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdfb3BlbicpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYiA9ICQodGhpcykuZGF0YSgndGFiJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHdyYXBwZXIgPSAkKHRoaXMpLmNsb3Nlc3QoJy5qLXRhYi13cmFwcGVyJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHdyYXBwZXIuZmluZCgnLmotdGFiLXRyaWdnZXInKS5yZW1vdmVDbGFzcygnX2N1cnJlbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgJHdyYXBwZXIuZmluZCgnLmotdGFiLWl0ZW0nKS5yZW1vdmVDbGFzcygnX29wZW4nKTtcblxuICAgICAgICAgICAgICAgICAgICAkd3JhcHBlci5maW5kKCcjdGFiLScrdGFiKS5hZGRDbGFzcygnX29wZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnX2N1cnJlbnQnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoZG9jdW1lbnQuYm9keSk7IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuKGZ1bmN0aW9uKGJvZHkpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgYXBwLnRvZ2dsZSA9IHtcbiAgICAgICAgXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgJHRvZ2dsZSA9IG51bGwsIHRleHQgPSAnJywgaGlkZSA9IHRydWUsIHJlbW92ZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJy5qLXRvZ2dsZS10cmlnZ2VyJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgJHRvZ2dsZSA9ICQodGhpcykuY2xvc2VzdCgnLmotdG9nZ2xlJykuZmluZCgnLmotdG9nZ2xlLWl0ZW0nKTtcblxuICAgICAgICAgICAgICAgIGlmICgkdG9nZ2xlKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgJHRvZ2dsZS50b2dnbGVDbGFzcygnaXMtc2hvdycpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICgkdG9nZ2xlLmhhc0NsYXNzKCdpcy1oaWRkZW4nKSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICR0b2dnbGUucmVtb3ZlQ2xhc3MoJ2lzLWhpZGRlbicpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmRhdGEoJ3RvZ2dsZS10ZXh0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICQodGhpcykuZGF0YSgndG9nZ2xlLXRleHQnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKCQodGhpcykuZGF0YSgncmVtb3ZlJykpICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmUgPSAkKHRoaXMpLmRhdGEoJ3JlbW92ZScpID09ICcwJyA/IGZhbHNlIDogKCQodGhpcykuZGF0YSgncmVtb3ZlJykgPT0gJzEnID8gdHJ1ZSA6IGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKGhpZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChyZW1vdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmRhdGEoJ3RvZ2dsZS10ZXh0JywgJCh0aGlzKS5odG1sKCkpO1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmh0bWwodGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG59KShkb2N1bWVudC5ib2R5KTtcblxuLy8gPGRpdiBjbGFzcz1cImotdG9nZ2xlXCI+XG4vLyAgICAgPGRpdiBjbGFzcz1cImotdG9nZ2xlLWl0ZW1cIj4gY29udGVudCA8L2Rpdj5cbi8vICAgICA8c3BhbiBjbGFzcz1cImotdG9nZ2xlLXRyaWdnZXJcIiBkYXRhLXRvZ2dsZS10ZXh0PVwi0KHQutGA0YvRgtGMLi4uXCIgZGF0YS1oaWRlPVwiMVwiIGRhdGEtcmVtb3ZlPVwiMVwiPtCV0YnQtS4uLjwvc3Bhbj5cbi8vIDwvZGl2PiIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBzcHJpbnRmKHYpIHtcbiAgdmFyIHNwbGl0ID0gdi50b1N0cmluZygpLnNwbGl0KCcuJyksIHBhZCA9IFwiMDBcIiwgdGltZSA9IFtdLCB4ID0gbnVsbDtcblxuICBmb3IgKHggaW4gc3BsaXQpIHtcbiAgICB0aW1lLnB1c2gocGFkLnN1YnN0cmluZygwLCAyIC0gc3BsaXRbeF0udG9TdHJpbmcoKS5sZW5ndGgpICsgc3BsaXRbeF0pO1xuICB9XG5cbiAgcmV0dXJuIHRpbWUuam9pbignLicpO1xufSIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIGFwcC5pbml0KCk7XG59KTsiXX0=
